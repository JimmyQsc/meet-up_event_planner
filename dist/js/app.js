function validateOnSubmit(e){_.each(e,function(e){e.validateInput(),e.input[0].setCustomValidity(e.getMessage())})}var app=app||{};!function(){app.Event=Backbone.Model.extend({defaults:{name:"",type:"",host:"",startTime:"",endTime:"",guestList:"Coolest people on earth",location:"",extraInfo:"No additional information",color:"#fec000"}})}();var app=app||{};!function(){app.User=Backbone.Model.extend({defaults:{login:!1,userName:"",userEmail:"",userPwd:""},localStorage:new Backbone.LocalStorage("user")})}(),$(function(){var e=new app.User({id:1}),t=new app.RegisterView({model:e});new app.MainView;var s=$("#submit");s.click(function(){validateOnSubmit(t.formInputs)})});var app=app||{};!function(){app.EventsCollection=Backbone.Collection.extend({model:app.Event,localStorage:new Backbone.LocalStorage("events")}),app.events=new app.EventsCollection}();var app=app||{};!function(){var e=Backbone.Router.extend({routes:{"":"defaultView","list-events":"listEvents"},defaultView:function(){$(".event-form").addClass("open"),$(".events-view").removeClass("open"),$(".addEvent").addClass("current"),$(".listEvent").removeClass("current")},listEvents:function(){$(".event-form").removeClass("open"),$(".events-view").addClass("open"),$(".addEvent").removeClass("current"),$(".listEvent").addClass("current")}});app.router=new e,Backbone.history.start()}();var app=app||{};!function(){var e=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,t=/^[a-z]+$/i,s=/^[a-z0-9]+$/i,n=/^\s+$/,r=/^[a-zA-Z ]*$/;app.FormErrorMessages={required:"This field is required.",validEmail:"The email address is not valid.",minLength:"This field must contain at least %s characters.",maxLength:"This field must not exceed %s characters in length.",alpha:"This field must only contain alphabetical characters.",alphaNumeric:"This field must only contain alpha-numeric characters.",hasNumber:"This field must contain number.",hasLetter:"This field must contain letter.",nameWithSpace:"This field must only contain alphabetical characters and space between.",laterThan:"This should happen at a later time"},app.FormErrorChecker={required:function(e){return n.test(e)?app.FormErrorMessages.required:e.length<1?app.FormErrorMessages.required:""},validEmail:function(t){return e.test(t)?"":app.FormErrorMessages.validEmail},minLength:function(e){return function(t){return t.length<e?app.FormErrorMessages.minLength.replace("%s",e):""}},maxLength:function(e){return function(t){return t.length>e?app.FormErrorMessages.maxLength.replace("%s",e):""}},alpha:function(e){return t.test(e)?"":app.FormErrorMessages.alpha},alphaNumeric:function(e){return s.test(e)?"":app.FormErrorMessages.alphaNumeric},hasNumber:function(e){return e.match(/\d/g)?"":app.FormErrorMessages.hasNumber},hasLetter:function(e){return e.match(/[a-z,A-z]/g)?"":app.FormErrorMessages.hasLetter},nameWithSpace:function(e){return r.test(e)?"":app.FormErrorMessages.nameWithSpace},laterThan:function(e){return function(t){if(t)return Date.parse(t)<Date.parse(e)?app.FormErrorMessages.laterThan:""}}}}();var SuperInput=function(e){this.input=e,this.requirements=[],this.isValid=!1,this.alertEl=e.parent().find("p.alert")};SuperInput.prototype={getInputValue:function(){return this.input.val()},addMessage:function(e){this.messages.push(e)},getMessage:function(){var e="";return this.messages.length>0&&(e=this.messages.join(". \n")),e},validateInput:function(){var e=this.getInputValue();this.messages=[],_.each(this.requirements,function(t){var s=t(e);s&&this.addMessage(s)},this),this.messages.length?this.isValid=!1:this.isValid=!0},checkOnChange:function(){var e=this;return this.input.on("change blur",function(){e.validateInput(),e.alert()}),e},checkOnKeyup:function(){var e=this;return this.input.on("keyup",function(){e.validateInput(),e.alert()}),e},alert:function(){this.isValid?(this.alertEl.html(""),this.input.removeClass("invalid")):(this.alertEl.html(this.getMessage()),this.input.addClass("invalid"))}};var app=app||{};!function(e){app.EventView=Backbone.View.extend({tagName:"li",className:"event",template:_.template(e("#event-template").html()),intialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.model.get("color");return this.$el.css({background:e,"border-color":e}),this}})}(jQuery);var app=app||{};!function(e){app.MainView=Backbone.View.extend({el:".planer-app",events:{"click #add":"validate","submit #add-event":"createEvent","change input, textarea":"progress"},initialize:function(){this.$list=e(".event-list"),this.$eventsView=e(".events-view"),this.$eventForm=e(".event-form"),this.$progress=e("#e-f-p"),this.formProgress=1,this.eventHost=new SuperInput(e("#event-host")),this.endTime=new SuperInput(e("#end-time")),this.guestList=new SuperInput(e("#guest-list")),this.extraInfo=new SuperInput(e("#extra-info")),this.eventColor=new SuperInput(e("#event-color")),this.eventName=new SuperInput(e("#event-name")),this.eventType=new SuperInput(e("#event-type")),this.startTime=new SuperInput(e("#start-time")),this.eventLocation=new SuperInput(e("#event-location")),this.requiredInputs=[this.eventName,this.eventType,this.eventHost,this.eventLocation,this.guestList,this.startTime,this.endTime],_.each(this.requiredInputs,function(e){e.requirements.push(app.FormErrorChecker.required),e.checkOnChange()}),this.startTime.requirements.push(app.FormErrorChecker.laterThan((new Date).toISOString())),this.endTime.requirements.push(app.FormErrorChecker.laterThan(this.startTime.getInputValue())),this.$form=e("#add-event"),e("#event-color").val("#FECE00"),this.appHeight=this.$eventForm[0].offsetHeight,this.listenTo(app.events,"add",this.appendItem),app.events.fetch(),this.render()},render:function(){this.$eventsView.css("margin-top",-this.appHeight),this.$eventsView.css("height",this.appHeight)},appendItem:function(e){var t=new app.EventView({model:e});this.$list.append(t.render().el)},validate:function(){validateOnSubmit(this.requiredInputs)},createEvent:function(){return app.events.create({name:this.eventName.getInputValue(),type:this.eventType.getInputValue(),host:this.eventHost.getInputValue(),startTime:this.startTime.getInputValue(),endTime:this.endTime.getInputValue(),guestList:this.eventLocation.getInputValue(),location:this.guestList.getInputValue(),extraInfo:this.extraInfo.getInputValue(),color:this.eventColor.getInputValue()}),this.resetForm(),!1},resetForm:function(){this.$form[0].reset(),this.$progress.val(0),e("#event-color").val("#FECE00")},progress:function(){this.formProgress=0,_.each(this.requiredInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}})}(jQuery);var app=app||{};!function(e){app.RegisterView=Backbone.View.extend({el:".user-state",events:{"click #regist-btn":"showRegist","submit #registration":"saveUser","change input":"updateProgress"},template:_.template(e("#user-template").html()),initialize:function(){this.formLayer=e(".regist"),this.registBtn=e("#regist-btn"),this.$userInfo=e("#user"),this.form=e("#registration"),this.jobTitle=e("#jobTitle"),this.submitBtn=e("#submit"),this.$progress=e("#r-f-p"),this.formProgress=0,this.sNameInput=new SuperInput(e("#name")),this.sNameInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.nameWithSpace],this.sEmailInput=new SuperInput(e("#email")),this.sEmailInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.validEmail],this.sPwdInput=new SuperInput(e("#password")),this.sPwdInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.minLength(6),app.FormErrorChecker.maxLength(16),app.FormErrorChecker.alphaNumeric,app.FormErrorChecker.hasNumber,app.FormErrorChecker.hasLetter],this.formInputs=[this.sNameInput,this.sEmailInput,this.sPwdInput],this.sNameInput.checkOnChange(),this.sEmailInput.checkOnChange(),this.sPwdInput.checkOnChange().checkOnKeyup(),e(".regist-form").click(function(e){e.stopPropagation()}),e(".regist, .close-form").click(function(){e(".regist").hide(),e("#event-name").focus()}),this.listenTo(this.model,"change",this.render),this.model.fetch(),this.render()},render:function(){this.updateProgress(),this.model.get("login")?(this.formLayer.hide(),this.registBtn.hide(),e("#event-name").focus(),this.$userInfo.html(this.template({name:this.model.get("userName")}))):(this.formLayer.show(),this.sNameInput.input.focus(),this.registBtn.show())},showRegist:function(){this.render()},saveUser:function(){this.model.save({userName:this.sNameInput.getInputValue(),userEmail:this.sEmailInput.getInputValue(),userPwd:this.sPwdInput.getInputValue(),jboTitle:this.jobTitle.val(),login:!0})},updateProgress:function(){this.formProgress=0,_.each(this.formInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}})}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRpb24vdmFsaWRhdGlvbi5qcyIsImV2ZW50LmpzIiwidXNlci5qcyIsImNvbGxlY3Rpb25zL2V2ZW50cy5qcyIsInJvdXRlci9yb3V0ZXIuanMiLCJ2aWV3cy9ldmVudC5qcyIsInZpZXdzL21haW5WaWV3LmpzIiwidmlld3MvcmVnaXN0ZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGVPblN1Ym1pdCIsInNJbnB1dHMiLCJfIiwiZWFjaCIsInNJbnB1dCIsInZhbGlkYXRlSW5wdXQiLCJpbnB1dCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZ2V0TWVzc2FnZSIsImFwcCIsIkV2ZW50IiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwibmFtZSIsInR5cGUiLCJob3N0Iiwic3RhcnRUaW1lIiwiZW5kVGltZSIsImd1ZXN0TGlzdCIsImxvY2F0aW9uIiwiZXh0cmFJbmZvIiwiY29sb3IiLCJVc2VyIiwibG9naW4iLCJ1c2VyTmFtZSIsInVzZXJFbWFpbCIsInVzZXJQd2QiLCJsb2NhbFN0b3JhZ2UiLCJMb2NhbFN0b3JhZ2UiLCIkIiwidXNlciIsImlkIiwicmVnaXN0ZXIiLCJSZWdpc3RlclZpZXciLCJtb2RlbCIsIk1haW5WaWV3Iiwic3VibWl0QnRuIiwiY2xpY2siLCJmb3JtSW5wdXRzIiwiRXZlbnRzQ29sbGVjdGlvbiIsIkNvbGxlY3Rpb24iLCJldmVudHMiLCJSb3V0ZXIiLCJyb3V0ZXMiLCIiLCJsaXN0LWV2ZW50cyIsImRlZmF1bHRWaWV3IiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImxpc3RFdmVudHMiLCJyb3V0ZXIiLCJoaXN0b3J5Iiwic3RhcnQiLCJlbWFpbFJlZ2V4IiwiYWxwaGFSZWdleCIsImFscGhhTnVtZXJpY1JlZ2V4Iiwic3BhY2VSZWdleCIsIm5hbWVSZWdleCIsIkZvcm1FcnJvck1lc3NhZ2VzIiwicmVxdWlyZWQiLCJ2YWxpZEVtYWlsIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwiYWxwaGEiLCJhbHBoYU51bWVyaWMiLCJoYXNOdW1iZXIiLCJoYXNMZXR0ZXIiLCJuYW1lV2l0aFNwYWNlIiwibGF0ZXJUaGFuIiwiRm9ybUVycm9yQ2hlY2tlciIsInZhbHVlIiwidGVzdCIsImxlbmd0aCIsInJlcGxhY2UiLCJtYXRjaCIsImRhdGVUaW1lIiwiRGF0ZSIsInBhcnNlIiwiU3VwZXJJbnB1dCIsInRoaXMiLCJyZXF1aXJlbWVudHMiLCJpc1ZhbGlkIiwiYWxlcnRFbCIsInBhcmVudCIsImZpbmQiLCJwcm90b3R5cGUiLCJnZXRJbnB1dFZhbHVlIiwidmFsIiwiYWRkTWVzc2FnZSIsIm1lc3NhZ2UiLCJtZXNzYWdlcyIsInB1c2giLCJqb2luIiwicmVxdWlyZW1lbnQiLCJtc2ciLCJjaGVja09uQ2hhbmdlIiwic2VsZiIsIm9uIiwiYWxlcnQiLCJjaGVja09uS2V5dXAiLCJodG1sIiwiRXZlbnRWaWV3IiwiVmlldyIsInRhZ05hbWUiLCJjbGFzc05hbWUiLCJ0ZW1wbGF0ZSIsImludGlhbGl6ZSIsImxpc3RlblRvIiwicmVuZGVyIiwiJGVsIiwiYXR0cmlidXRlcyIsImV2ZW50Q29sb3IiLCJnZXQiLCJjc3MiLCJiYWNrZ3JvdW5kIiwiYm9yZGVyLWNvbG9yIiwialF1ZXJ5IiwiZWwiLCJjbGljayAjYWRkIiwic3VibWl0ICNhZGQtZXZlbnQiLCJjaGFuZ2UgaW5wdXQsIHRleHRhcmVhIiwiaW5pdGlhbGl6ZSIsIiRsaXN0IiwiJGV2ZW50c1ZpZXciLCIkZXZlbnRGb3JtIiwiJHByb2dyZXNzIiwiZm9ybVByb2dyZXNzIiwiZXZlbnRIb3N0IiwiZXZlbnROYW1lIiwiZXZlbnRUeXBlIiwiZXZlbnRMb2NhdGlvbiIsInJlcXVpcmVkSW5wdXRzIiwidG9JU09TdHJpbmciLCIkZm9ybSIsImFwcEhlaWdodCIsIm9mZnNldEhlaWdodCIsImFwcGVuZEl0ZW0iLCJmZXRjaCIsImV2ZW50IiwidmlldyIsImFwcGVuZCIsInZhbGlkYXRlIiwiY3JlYXRlRXZlbnQiLCJjcmVhdGUiLCJyZXNldEZvcm0iLCJyZXNldCIsInByb2dyZXNzIiwiY2xpY2sgI3JlZ2lzdC1idG4iLCJzdWJtaXQgI3JlZ2lzdHJhdGlvbiIsImNoYW5nZSBpbnB1dCIsImZvcm1MYXllciIsInJlZ2lzdEJ0biIsIiR1c2VySW5mbyIsImZvcm0iLCJqb2JUaXRsZSIsInNOYW1lSW5wdXQiLCJzRW1haWxJbnB1dCIsInNQd2RJbnB1dCIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJoaWRlIiwiZm9jdXMiLCJ1cGRhdGVQcm9ncmVzcyIsInNob3ciLCJzaG93UmVnaXN0Iiwic2F2ZVVzZXIiLCJzYXZlIiwiamJvVGl0bGUiXSwibWFwcGluZ3MiOiJBQWlMQSxRQUFBQSxrQkFBQUMsR0FDQUMsRUFBQUMsS0FBQUYsRUFBQSxTQUFBRyxHQUNBQSxFQUFBQyxnQkFDQUQsRUFBQUUsTUFBQSxHQUFBQyxrQkFBQUgsRUFBQUksZ0JDcExBLEdBQUFDLEtBQUFBLFNBR0EsV0FDQUEsSUFBQUMsTUFBQUMsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQUMsS0FBQSxHQUNBQyxLQUFBLEdBQ0FDLEtBQUEsR0FDQUMsVUFBQSxHQUNBQyxRQUFBLEdBQ0FDLFVBQUEsMEJBQ0FDLFNBQUEsR0FDQUMsVUFBQSw0QkFDQUMsTUFBQSxlQ2RBLElBQUFkLEtBQUFBLFNBRUEsV0FDQUEsSUFBQWUsS0FBQWIsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQVcsT0FBQSxFQUNBQyxTQUFBLEdBQ0FDLFVBQUEsR0FDQUMsUUFBQSxJQUdBQyxhQUFBLEdBQUFsQixVQUFBbUIsYUFBQSxhRFhBQyxFQUFBLFdBRUEsR0FBQUMsR0FBQSxHQUFBdkIsS0FBQWUsTUFBQVMsR0FBQSxJQUdBQyxFQUFBLEdBQUF6QixLQUFBMEIsY0FBQUMsTUFBQUosR0FHQSxJQUFBdkIsS0FBQTRCLFFBR0EsSUFBQUMsR0FBQVAsRUFBQSxVQUdBTyxHQUFBQyxNQUFBLFdBQ0F2QyxpQkFBQWtDLEVBQUFNLGVFZkEsSUFBQS9CLEtBQUFBLFNBRUEsV0FDQUEsSUFBQWdDLGlCQUFBOUIsU0FBQStCLFdBQUE3QixR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WUFBQTdELGdCQUVBaEIsS0FBQThFLFVBQUE5RCxnQkFBQUksZUFHQXRFLEVBQUEsZ0JBQUFRLE1BQUEsU0FBQXlILEdBQ0FBLEVBQUFDLG9CQUdBbEksRUFBQSx3QkFBQVEsTUFBQSxXQUNBUixFQUFBLFdBQUFtSSxPQUNBbkksRUFBQSxlQUFBb0ksVUFJQWxGLEtBQUE0QixTQUFBNUIsS0FBQTdDLE1BQUEsU0FBQTZDLEtBQUE2QixRQUVBN0IsS0FBQTdDLE1BQUF1RyxRQUVBMUQsS0FBQTZCLFVBR0FBLE9BQUEsV0FDQTdCLEtBQUFtRixpQkFFQW5GLEtBQUE3QyxNQUFBOEUsSUFBQSxVQUtBakMsS0FBQXVFLFVBQUFVLE9BQ0FqRixLQUFBd0UsVUFBQVMsT0FDQW5JLEVBQUEsZUFBQW9JLFFBQ0FsRixLQUFBeUUsVUFBQXBELEtBQUFyQixLQUFBMEIsVUFBQTVGLEtBQUFrRSxLQUFBN0MsTUFBQThFLElBQUEsaUJBUEFqQyxLQUFBdUUsVUFBQWEsT0FDQXBGLEtBQUE0RSxXQUFBdkosTUFBQTZKLFFBQ0FsRixLQUFBd0UsVUFBQVksU0FVQUMsV0FBQSxXQUNBckYsS0FBQTZCLFVBSUF5RCxTQUFBLFdBQ0F0RixLQUFBN0MsTUFBQW9JLE1BQ0E5SSxTQUFBdUQsS0FBQTRFLFdBQUFyRSxnQkFDQTdELFVBQUFzRCxLQUFBNkUsWUFBQXRFLGdCQUNBNUQsUUFBQXFELEtBQUE4RSxVQUFBdkUsZ0JBQ0FpRixTQUFBeEYsS0FBQTJFLFNBQUFuRSxNQUNBaEUsT0FBQSxLQUlBMkksZUFBQSxXQUNBbkYsS0FBQStDLGFBQUEsRUFDQTlILEVBQUFDLEtBQUE4RSxLQUFBekMsV0FBQSxTQUFBbEMsR0FDQUEsRUFBQTZFLFNBQ0FGLEtBQUErQyxnQkFDQS9DLE1BQ0FBLEtBQUE4QyxVQUFBdEMsSUFBQVIsS0FBQStDLGtCQUdBViIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgLy9yZWd1bGFyIGV4cHJlc3Npb25zXG4gICAgdmFyIGVtYWlsUmVnZXggPSAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC8sXG4gICAgICAgIGFscGhhUmVnZXggPSAvXlthLXpdKyQvaSxcbiAgICAgICAgYWxwaGFOdW1lcmljUmVnZXggPSAvXlthLXowLTldKyQvaSxcbiAgICAgICAgc3BhY2VSZWdleCA9IC9eXFxzKyQvLFxuICAgICAgICBuYW1lUmVnZXggPSAvXlthLXpBLVogXSokLztcblxuICAgIC8vbWVzc2FnZXMgd2hlbiByZXF1aXJlbWVudCBkb2Vzbid0IHBhc3NcbiAgICBhcHAuRm9ybUVycm9yTWVzc2FnZXMgPSB7XG4gICAgICAgIHJlcXVpcmVkOiAnVGhpcyBmaWVsZCBpcyByZXF1aXJlZC4nLFxuICAgICAgICB2YWxpZEVtYWlsOiAnVGhlIGVtYWlsIGFkZHJlc3MgaXMgbm90IHZhbGlkLicsXG4gICAgICAgIG1pbkxlbmd0aDogJ1RoaXMgZmllbGQgbXVzdCBjb250YWluIGF0IGxlYXN0ICVzIGNoYXJhY3RlcnMuJyxcbiAgICAgICAgbWF4TGVuZ3RoOiAnVGhpcyBmaWVsZCBtdXN0IG5vdCBleGNlZWQgJXMgY2hhcmFjdGVycyBpbiBsZW5ndGguJyxcbiAgICAgICAgYWxwaGE6ICdUaGlzIGZpZWxkIG11c3Qgb25seSBjb250YWluIGFscGhhYmV0aWNhbCBjaGFyYWN0ZXJzLicsXG4gICAgICAgIGFscGhhTnVtZXJpYzogJ1RoaXMgZmllbGQgbXVzdCBvbmx5IGNvbnRhaW4gYWxwaGEtbnVtZXJpYyBjaGFyYWN0ZXJzLicsXG4gICAgICAgIGhhc051bWJlcjogJ1RoaXMgZmllbGQgbXVzdCBjb250YWluIG51bWJlci4nLFxuICAgICAgICBoYXNMZXR0ZXI6ICdUaGlzIGZpZWxkIG11c3QgY29udGFpbiBsZXR0ZXIuJyxcbiAgICAgICAgbmFtZVdpdGhTcGFjZTogJ1RoaXMgZmllbGQgbXVzdCBvbmx5IGNvbnRhaW4gYWxwaGFiZXRpY2FsIGNoYXJhY3RlcnMgYW5kIHNwYWNlIGJldHdlZW4uJyxcbiAgICAgICAgbGF0ZXJUaGFuOiAnVGhpcyBzaG91bGQgaGFwcGVuIGF0IGEgbGF0ZXIgdGltZSdcbiAgICB9O1xuXG4gICAgLy9tZXRob2RzIHRvIHZhbGlkYXRlIHRoZSBpbnB1dCB2YWx1ZVxuICAgIGFwcC5Gb3JtRXJyb3JDaGVja2VyID0ge1xuICAgICAgICByZXF1aXJlZDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHZhbHVlIG9ubHkgY290YWlucyBzcGFjZXNcbiAgICAgICAgICAgIGlmIChzcGFjZVJlZ2V4LnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5yZXF1aXJlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGg8MSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMucmVxdWlyZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIHZhbGlkRW1haWw6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIWVtYWlsUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLnZhbGlkRW1haWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIG1pbkxlbmd0aDogZnVuY3Rpb24obGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMubWluTGVuZ3RoLnJlcGxhY2UoJyVzJywgbGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfTsgICBcbiAgICAgICAgfSxcbiAgICAgICAgbWF4TGVuZ3RoOiBmdW5jdGlvbihsZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5tYXhMZW5ndGgucmVwbGFjZSgnJXMnLCBsZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBhbHBoYTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghYWxwaGFSZWdleC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMuYWxwaGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGFscGhhTnVtZXJpYzogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghYWxwaGFOdW1lcmljUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLmFscGhhTnVtZXJpYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgaGFzTnVtYmVyOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2YWx1ZS5tYXRjaCgvXFxkL2cpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5oYXNOdW1iZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGhhc0xldHRlcjogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdmFsdWUubWF0Y2goL1thLXosQS16XS9nKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMuaGFzTGV0dGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9LFxuICAgICAgICBuYW1lV2l0aFNwYWNlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCFuYW1lUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLm5hbWVXaXRoU3BhY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGxhdGVyVGhhbjogZnVuY3Rpb24oZGF0ZVRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoRGF0ZS5wYXJzZSh2YWx1ZSkgPCBEYXRlLnBhcnNlKGRhdGVUaW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5sYXRlclRoYW47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICB9O1xufSkoKTtcblxuLyoqXG4gKiBNYWtlIGEgaW5wdXQgdG8gYSBTdXBlcklucHV0IHRvIHZhbGlkYXRlIGl0cyB2YWx1ZVxuICovXG52YXIgU3VwZXJJbnB1dCA9IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgIHRoaXMucmVxdWlyZW1lbnRzID0gW107XG4gICAgdGhpcy5pc1ZhbGlkID0gZmFsc2U7XG4gICAgdGhpcy5hbGVydEVsID0gaW5wdXQucGFyZW50KCkuZmluZCgncC5hbGVydCcpO1xufVxuXG5TdXBlcklucHV0LnByb3RvdHlwZSA9IHtcbiAgICBnZXRJbnB1dFZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQudmFsKCk7XG4gICAgfSxcblxuICAgIGFkZE1lc3NhZ2UgOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICB9LFxuXG4gICAgZ2V0TWVzc2FnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBtZXNzYWdlID0gJyc7XG4gICAgICAgIGlmKHRoaXMubWVzc2FnZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbWVzc2FnZSA9IHRoaXMubWVzc2FnZXMuam9pbignLiBcXG4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICB9LFxuXG4gICAgdmFsaWRhdGVJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG5cbiAgICAgICAgXy5lYWNoKHRoaXMucmVxdWlyZW1lbnRzLCBmdW5jdGlvbihyZXF1aXJlbWVudCkge1xuICAgICAgICAgICAgdmFyIG1zZyA9IHJlcXVpcmVtZW50KHZhbHVlKTtcbiAgICAgICAgICAgIGlmKG1zZyl7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKG1zZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5pc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlzVmFsaWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNoZWNrT25DaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuaW5wdXQub24oJ2NoYW5nZSBibHVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLnZhbGlkYXRlSW5wdXQoKTtcbiAgICAgICAgICAgIHNlbGYuYWxlcnQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzZWxmO1xuICAgIH0sXG5cbiAgICBjaGVja09uS2V5dXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuaW5wdXQub24oJ2tleXVwJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLnZhbGlkYXRlSW5wdXQoKTtcbiAgICAgICAgICAgIHNlbGYuYWxlcnQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzZWxmO1xuICAgIH0sXG5cbiAgICBhbGVydDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLmFsZXJ0RWwuaHRtbCh0aGlzLmdldE1lc3NhZ2UoKSk7XG4gICAgICAgICAgICB0aGlzLmlucHV0LmFkZENsYXNzKCdpbnZhbGlkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFsZXJ0RWwuaHRtbCgnJyk7XG4gICAgICAgICAgICB0aGlzLmlucHV0LnJlbW92ZUNsYXNzKCdpbnZhbGlkJyk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5cbi8vdmFsaWRhdGUgd2hlbiBzdWJtaXR0aW5nIHRoZSBmb3JtXG5mdW5jdGlvbiB2YWxpZGF0ZU9uU3VibWl0KHNJbnB1dHMpIHtcbiAgICBfLmVhY2goc0lucHV0cywgZnVuY3Rpb24oc0lucHV0KSB7XG4gICAgICAgIHNJbnB1dC52YWxpZGF0ZUlucHV0KCk7XG4gICAgICAgIHNJbnB1dC5pbnB1dFswXS5zZXRDdXN0b21WYWxpZGl0eShzSW5wdXQuZ2V0TWVzc2FnZSgpKTtcbiAgICB9KTtcbn0iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4vL01vZGVsIGZvciBhIGV2ZW50XG4oZnVuY3Rpb24oKSB7XG4gICAgYXBwLkV2ZW50ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgdHlwZTogJycsXG4gICAgICAgICAgICBob3N0OiAnJyxcbiAgICAgICAgICAgIHN0YXJ0VGltZTogJycsXG4gICAgICAgICAgICBlbmRUaW1lOiAnJyxcbiAgICAgICAgICAgIGd1ZXN0TGlzdDogJ0Nvb2xlc3QgcGVvcGxlIG9uIGVhcnRoJyxcbiAgICAgICAgICAgIGxvY2F0aW9uOiAnJyxcbiAgICAgICAgICAgIGV4dHJhSW5mbzonTm8gYWRkaXRpb25hbCBpbmZvcm1hdGlvbicsXG4gICAgICAgICAgICBjb2xvcjogJyNmZWMwMDAnXG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgYXBwLlVzZXIgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgbG9naW46IGZhbHNlLFxuICAgICAgICAgICAgdXNlck5hbWU6ICcnLFxuICAgICAgICAgICAgdXNlckVtYWlsOiAnJyxcbiAgICAgICAgICAgIHVzZXJQd2Q6ICcnXG4gICAgICAgIH0sXG4gICAgICAgIC8vc2F2aW5nIHVzZXIgaW5mbyB0byBsb2NhbCBzdG9yYWdlXG4gICAgICAgIGxvY2FsU3RvcmFnZTogbmV3IEJhY2tib25lLkxvY2FsU3RvcmFnZSgndXNlcicpLFxuICAgIH0pO1xufSkoKTtcbiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbigpIHtcbiAgICBhcHAuRXZlbnRzQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcbiAgICAgICAgLy9yZWZlcmVuY2UgdG8gaXRzIG1vZGVsXG4gICAgICAgIG1vZGVsOiBhcHAuRXZlbnQsXG4gICAgICAgIGxvY2FsU3RvcmFnZTogbmV3IEJhY2tib25lLkxvY2FsU3RvcmFnZSgnZXZlbnRzJyksXG4gICAgfSk7XG4gICAgXG4gICAgYXBwLmV2ZW50cyA9IG5ldyBhcHAuRXZlbnRzQ29sbGVjdGlvbigpO1xufSkoKTtcbiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBUaGUgcm91dGVyIG1ha2Ugc3VyZSB0aGUgdXJsIGNoYW5nZSB3aWxsIGNoYW5nZSB0aGUgYXBwJ3MgdmlldywgdGhlIHJpZ2h0IHVybFxuICAgICAqIGFsd2F5cyBicmluZ3MgdGhlIHJpZ2h0IHZpZXdcbiAgICAgKi9cbiAgICB2YXIgUm91dGVyID0gQmFja2JvbmUuUm91dGVyLmV4dGVuZCh7XG4gICAgICAgIHJvdXRlczoge1xuICAgICAgICAgICAgJyc6ICdkZWZhdWx0VmlldycsXG4gICAgICAgICAgICAnbGlzdC1ldmVudHMnOiAnbGlzdEV2ZW50cydcbiAgICAgICAgfSxcblxuICAgICAgICAvL21ha2Ugc3VyZSB0aGUgcmlnaHQgdmlldyBpcyBvcGVuXG4gICAgICAgIGRlZmF1bHRWaWV3OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5ldmVudC1mb3JtJykuYWRkQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICQoJy5ldmVudHMtdmlldycpLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICAkKCcuYWRkRXZlbnQnKS5hZGRDbGFzcygnY3VycmVudCcpO1xuICAgICAgICAgICAgJCgnLmxpc3RFdmVudCcpLnJlbW92ZUNsYXNzKCdjdXJyZW50Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGlzdEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuZXZlbnQtZm9ybScpLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICAkKCcuZXZlbnRzLXZpZXcnKS5hZGRDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgJCgnLmFkZEV2ZW50JykucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgICAgICQoJy5saXN0RXZlbnQnKS5hZGRDbGFzcygnY3VycmVudCcpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBhcHAucm91dGVyID0gbmV3IFJvdXRlcigpO1xuICAgIEJhY2tib25lLmhpc3Rvcnkuc3RhcnQoKTtcbn0pKCk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oJCkge1xuICAgIGFwcC5FdmVudFZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgICAgIHRhZ05hbWU6ICdsaScsXG5cbiAgICAgICAgY2xhc3NOYW1lOiAnZXZlbnQnLFxuICAgICAgICAvL3RlbXBsYXRlIHRvIHJlbmRlciBhIGV2ZW50XG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCQoJyNldmVudC10ZW1wbGF0ZScpLmh0bWwoKSksXG5cbiAgICAgICAgLy9saXN0ZW4gdG8gbW9kZWwgZXZlbnQgaW4gaW5pdGlhbGl6YXRpb25cbiAgICAgICAgaW50aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgJ2NoYW5nZScsIHRoaXMucmVuZGVyKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy9yZW5iZXIgYSBzaW5nbGUgZXZlbnQncyB2aWV3XG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUodGhpcy5tb2RlbC5hdHRyaWJ1dGVzKSk7XG4gICAgICAgICAgICB2YXIgZXZlbnRDb2xvciA9IHRoaXMubW9kZWwuZ2V0KCdjb2xvcicpO1xuICAgICAgICAgICAgdGhpcy4kZWwuY3NzKHtcbiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZCc6IGV2ZW50Q29sb3IsXG4gICAgICAgICAgICAgICAgJ2JvcmRlci1jb2xvcic6IGV2ZW50Q29sb3IsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpO1xuIiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKCQpIHtcbiAgICBhcHAuTWFpblZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgICAgIGVsOiAnLnBsYW5lci1hcHAnLFxuXG4gICAgICAgIGV2ZW50czoge1xuICAgICAgICAgICAgJ2NsaWNrICNhZGQnOiAndmFsaWRhdGUnLFxuICAgICAgICAgICAgJ3N1Ym1pdCAjYWRkLWV2ZW50JzogJ2NyZWF0ZUV2ZW50JyxcbiAgICAgICAgICAgICdjaGFuZ2UgaW5wdXQsIHRleHRhcmVhJzogJ3Byb2dyZXNzJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9jYWNoZSBkb20gZWxlbWVudFxuICAgICAgICAgICAgdGhpcy4kbGlzdCA9ICQoJy5ldmVudC1saXN0Jyk7XG4gICAgICAgICAgICB0aGlzLiRldmVudHNWaWV3ID0gJCgnLmV2ZW50cy12aWV3Jyk7XG4gICAgICAgICAgICB0aGlzLiRldmVudEZvcm0gPSAkKCcuZXZlbnQtZm9ybScpO1xuICAgICAgICAgICAgdGhpcy4kcHJvZ3Jlc3MgPSAkKCcjZS1mLXAnKTtcblxuICAgICAgICAgICAgdGhpcy5mb3JtUHJvZ3Jlc3MgPSAxO1xuICAgICAgICAgICAgLy9hbGwgdGhlIGlucHV0c1xuICAgICAgICAgICAgdGhpcy5ldmVudEhvc3QgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZXZlbnQtaG9zdCcpKTtcbiAgICAgICAgICAgIHRoaXMuZW5kVGltZSA9IG5ldyBTdXBlcklucHV0KCQoJyNlbmQtdGltZScpKTtcbiAgICAgICAgICAgIHRoaXMuZ3Vlc3RMaXN0ID0gbmV3IFN1cGVySW5wdXQoJCgnI2d1ZXN0LWxpc3QnKSk7XG4gICAgICAgICAgICB0aGlzLmV4dHJhSW5mbyA9IG5ldyBTdXBlcklucHV0KCQoJyNleHRyYS1pbmZvJykpO1xuICAgICAgICAgICAgdGhpcy5ldmVudENvbG9yID0gbmV3IFN1cGVySW5wdXQoJCgnI2V2ZW50LWNvbG9yJykpO1xuXG4gICAgICAgICAgICB0aGlzLmV2ZW50TmFtZSA9ICBuZXcgU3VwZXJJbnB1dCgkKCcjZXZlbnQtbmFtZScpKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRUeXBlID0gbmV3IFN1cGVySW5wdXQoJCgnI2V2ZW50LXR5cGUnKSk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBTdXBlcklucHV0KCQoJyNzdGFydC10aW1lJykpO1xuICAgICAgICAgICAgdGhpcy5ldmVudExvY2F0aW9uID0gbmV3IFN1cGVySW5wdXQoJCgnI2V2ZW50LWxvY2F0aW9uJykpO1xuICAgICAgICAgICAgdGhpcy5yZXF1aXJlZElucHV0cyA9IFt0aGlzLmV2ZW50TmFtZSwgdGhpcy5ldmVudFR5cGUsIHRoaXMuZXZlbnRIb3N0LCB0aGlzLmV2ZW50TG9jYXRpb24sIHRoaXMuZ3Vlc3RMaXN0LCB0aGlzLnN0YXJ0VGltZSwgdGhpcy5lbmRUaW1lXTtcbiAgICAgICAgICAgIC8vZm9yIGV2ZXJ5IHJlcXVpcmVkIGlucHV0cyBhZGQgcmVxdWlyZWQgdG8gdGhlaXIgcmVxdWlyZW1lbnRzXG4gICAgICAgICAgICBfLmVhY2godGhpcy5yZXF1aXJlZElucHV0cywgZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5yZXF1aXJlbWVudHMucHVzaChhcHAuRm9ybUVycm9yQ2hlY2tlci5yZXF1aXJlZCk7XG4gICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tPbkNoYW5nZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL3RoZXNlIHR3byBuZWVkIHRvIGhhdmUgYSB0aW1lIGNoZWNrXG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZS5yZXF1aXJlbWVudHMucHVzaChhcHAuRm9ybUVycm9yQ2hlY2tlci5sYXRlclRoYW4obmV3IERhdGUoKS50b0lTT1N0cmluZygpKSk7XG4gICAgICAgICAgICB0aGlzLmVuZFRpbWUucmVxdWlyZW1lbnRzLnB1c2goYXBwLkZvcm1FcnJvckNoZWNrZXIubGF0ZXJUaGFuKHRoaXMuc3RhcnRUaW1lLmdldElucHV0VmFsdWUoKSkpO1xuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIHRoaXMuJGZvcm0gPSAkKCcjYWRkLWV2ZW50Jyk7XG4gICAgICAgICAgICAvL3NldCB0aGUgZGVmYXVsdCBjb2xvclxuICAgICAgICAgICAgJCgnI2V2ZW50LWNvbG9yJykudmFsKCcjRkVDRTAwJyk7XG5cbiAgICAgICAgICAgIHRoaXMuYXBwSGVpZ2h0ID0gdGhpcy4kZXZlbnRGb3JtWzBdLm9mZnNldEhlaWdodDtcblxuICAgICAgICAgICAgLy9saXN0ZW4gdG8gY29sbGVjdGlvbiBldmVudFxuICAgICAgICAgICAgdGhpcy5saXN0ZW5UbyhhcHAuZXZlbnRzLCAnYWRkJywgdGhpcy5hcHBlbmRJdGVtKTtcbiAgICAgICAgICAgIC8vZmV0Y2ggZGF0YSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgICAgICAgICAgYXBwLmV2ZW50cy5mZXRjaCgpO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9kcmFnIHRoZSBldmVudHMgdmlldyB0byB0aGUgcmlnaHQgcGxhY2VcbiAgICAgICAgICAgIHRoaXMuJGV2ZW50c1ZpZXcuY3NzKCdtYXJnaW4tdG9wJywgLXRoaXMuYXBwSGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuJGV2ZW50c1ZpZXcuY3NzKCdoZWlnaHQnLCB0aGlzLmFwcEhlaWdodCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXBwZW5kSXRlbTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgdmlldyBmb3IgdGhlIGV2ZW50XG4gICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBhcHAuRXZlbnRWaWV3KHttb2RlbDogZXZlbnR9KTtcbiAgICAgICAgICAgIC8vYXBwZW5kIGl0IHRvIHRoZSBsaXN0XG4gICAgICAgICAgICB0aGlzLiRsaXN0LmFwcGVuZCh2aWV3LnJlbmRlcigpLmVsKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YWxpZGF0ZU9uU3VibWl0KHRoaXMucmVxdWlyZWRJbnB1dHMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZUV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vY3JlYXRlIGFuIGV2ZW50IG1vZGVsXG4gICAgICAgICAgICBhcHAuZXZlbnRzLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5ldmVudE5hbWUuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuZXZlbnRUeXBlLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBob3N0OiB0aGlzLmV2ZW50SG9zdC5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB0aGlzLnN0YXJ0VGltZS5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgZW5kVGltZTogdGhpcy5lbmRUaW1lLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBndWVzdExpc3Q6IHRoaXMuZXZlbnRMb2NhdGlvbi5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgbG9jYXRpb246IHRoaXMuZ3Vlc3RMaXN0LmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBleHRyYUluZm86IHRoaXMuZXh0cmFJbmZvLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5ldmVudENvbG9yLmdldElucHV0VmFsdWUoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMucmVzZXRGb3JtKCk7XG4gICAgICAgICAgICAvL3ByZXZlbnQgcmVsb2FkIHBhZ2VcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvL3Jlc2V0IHRoZSBmb3JtXG4gICAgICAgIHJlc2V0Rm9ybTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLiRmb3JtWzBdLnJlc2V0KCk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcy52YWwoMCk7XG4gICAgICAgICAgICAkKCcjZXZlbnQtY29sb3InKS52YWwoJyNGRUNFMDAnKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvL3VwZGF0ZSB0aGUgcHJvZ3Jlc3MgYmFyXG4gICAgICAgIHByb2dyZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzID0gMDtcbiAgICAgICAgICAgIF8uZWFjaCh0aGlzLnJlcXVpcmVkSW5wdXRzLCBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlmKGlucHV0LmlzVmFsaWQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzKys7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuJHByb2dyZXNzLnZhbCh0aGlzLmZvcm1Qcm9ncmVzcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oJCkge1xuICAgIGFwcC5SZWdpc3RlclZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgICAgIGVsOiAnLnVzZXItc3RhdGUnLFxuXG4gICAgICAgIGV2ZW50czoge1xuICAgICAgICAgICAgJ2NsaWNrICNyZWdpc3QtYnRuJzogJ3Nob3dSZWdpc3QnLFxuICAgICAgICAgICAgJ3N1Ym1pdCAjcmVnaXN0cmF0aW9uJzogJ3NhdmVVc2VyJyxcbiAgICAgICAgICAgICdjaGFuZ2UgaW5wdXQnOiAndXBkYXRlUHJvZ3Jlc3MnXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy90ZW1wbGF0ZSBmb3IgdGhlIHVzZXJcbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJCgnI3VzZXItdGVtcGxhdGUnKS5odG1sKCkpLFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5mb3JtTGF5ZXIgPSAkKCcucmVnaXN0Jyk7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdEJ0biA9ICQoJyNyZWdpc3QtYnRuJyk7XG4gICAgICAgICAgICB0aGlzLiR1c2VySW5mbyA9ICQoJyN1c2VyJyk7XG5cbiAgICAgICAgICAgIC8vY2FjaGUgdXNlciByZWdpc3RyYXRpb24gZm9ybVxuICAgICAgICAgICAgdGhpcy5mb3JtID0gJCgnI3JlZ2lzdHJhdGlvbicpO1xuICAgICAgICAgICAgdGhpcy5qb2JUaXRsZSA9ICQoJyNqb2JUaXRsZScpO1xuICAgICAgICAgICAgdGhpcy5zdWJtaXRCdG4gPSAkKCcjc3VibWl0Jyk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcyA9ICQoJyNyLWYtcCcpO1xuICAgICAgICAgICAgdGhpcy5mb3JtUHJvZ3Jlc3MgPSAwO1xuICAgICAgICAgICAgLy9NYWtlIGlucHV0IHRvIFN1cGVySW5wdXQsIHVzZSBpdHMgbWV0aG9kIHRvIHZhbGlkYXRlIGlucHV0IHZhbHVlXG4gICAgICAgICAgICB0aGlzLnNOYW1lSW5wdXQgPSBuZXcgU3VwZXJJbnB1dCgkKCcjbmFtZScpKTtcbiAgICAgICAgICAgIC8vc2V0IHJlcXVpcmVtZW50cyBmb3IgZWxlbWVudFxuICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0LnJlcXVpcmVtZW50cyA9IFthcHAuRm9ybUVycm9yQ2hlY2tlci5yZXF1aXJlZCwgYXBwLkZvcm1FcnJvckNoZWNrZXIubmFtZVdpdGhTcGFjZV07XG5cbiAgICAgICAgICAgIHRoaXMuc0VtYWlsSW5wdXQgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZW1haWwnKSk7XG4gICAgICAgICAgICB0aGlzLnNFbWFpbElucHV0LnJlcXVpcmVtZW50cyA9IFthcHAuRm9ybUVycm9yQ2hlY2tlci5yZXF1aXJlZCwgYXBwLkZvcm1FcnJvckNoZWNrZXIudmFsaWRFbWFpbF07XG5cbiAgICAgICAgICAgIHRoaXMuc1B3ZElucHV0ID0gbmV3IFN1cGVySW5wdXQoJCgnI3Bhc3N3b3JkJykpO1xuICAgICAgICAgICAgdGhpcy5zUHdkSW5wdXQucmVxdWlyZW1lbnRzID0gW2FwcC5Gb3JtRXJyb3JDaGVja2VyLnJlcXVpcmVkLCBhcHAuRm9ybUVycm9yQ2hlY2tlci5taW5MZW5ndGgoNiksIGFwcC5Gb3JtRXJyb3JDaGVja2VyLm1heExlbmd0aCgxNiksIGFwcC5Gb3JtRXJyb3JDaGVja2VyLmFscGhhTnVtZXJpYywgYXBwLkZvcm1FcnJvckNoZWNrZXIuaGFzTnVtYmVyLCBhcHAuRm9ybUVycm9yQ2hlY2tlci5oYXNMZXR0ZXJdO1xuXG4gICAgICAgICAgICB0aGlzLmZvcm1JbnB1dHMgPSBbdGhpcy5zTmFtZUlucHV0LCB0aGlzLnNFbWFpbElucHV0LCB0aGlzLnNQd2RJbnB1dF07XG4gICAgICAgICAgICAvL3ZhbGlkYXRlIGlucHV0IHdoZW4gaW5wdXQgdmFsdWUgY2hhbmdlc1xuICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0LmNoZWNrT25DaGFuZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuc0VtYWlsSW5wdXQuY2hlY2tPbkNoYW5nZSgpO1xuICAgICAgICAgICAgLy92YWxpZGF0ZSBwYXNzd29yZCBvbiBldmVyeSBrZXl1cFxuICAgICAgICAgICAgdGhpcy5zUHdkSW5wdXQuY2hlY2tPbkNoYW5nZSgpLmNoZWNrT25LZXl1cCgpO1xuXG4gICAgICAgICAgICAvL2Nsb3NlIHRoZSBmb3JtIHdoZW4gdXNlciBjbGljayBvdXRzaWRlIHRoZSBmb3JtIG9yIHVzZXIgY2xpY2tzIHRoZSBjbG9zZSBidXR0b25cbiAgICAgICAgICAgICQoJy5yZWdpc3QtZm9ybScpLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5yZWdpc3QsIC5jbG9zZS1mb3JtJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCgnLnJlZ2lzdCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcjZXZlbnQtbmFtZScpLmZvY3VzKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9yZW1vdmUgdGhlIGRvbSBlbGVtZW50XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsICdjaGFuZ2UnLCB0aGlzLnJlbmRlcik7XG4gICAgICAgICAgICAvL2ZldGNoIGRhdGEgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICAgICAgICAgIHRoaXMubW9kZWwuZmV0Y2goKTtcbiAgICAgICAgICAgIC8vcmVuZGVyIHRoZSB2aWV3IGZvciB0aGUgZmlyc3QgdGltZVxuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcygpO1xuICAgICAgICAgICAgLy9pZiBubyB1c2VyIGxvZ2VkIGluIG9wZW4gdGVoIHJlZ2lzdGVyIGZvcm1cbiAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ2xvZ2luJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1MYXllci5zaG93KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0LmlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RCdG4uc2hvdygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1MYXllci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RCdG4uaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoJyNldmVudC1uYW1lJykuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR1c2VySW5mby5odG1sKHRoaXMudGVtcGxhdGUoe25hbWU6IHRoaXMubW9kZWwuZ2V0KCd1c2VyTmFtZScpfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8vc2hvdyB0aGUgcmVnaXN0ZXIgZm9ybVxuICAgICAgICBzaG93UmVnaXN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9zYXZlIHVzZXIgZGF0YVxuICAgICAgICBzYXZlVXNlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoe1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiB0aGlzLnNOYW1lSW5wdXQuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIHVzZXJFbWFpbDogdGhpcy5zRW1haWxJbnB1dC5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgdXNlclB3ZDogdGhpcy5zUHdkSW5wdXQuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIGpib1RpdGxlOiB0aGlzLmpvYlRpdGxlLnZhbCgpLCBcbiAgICAgICAgICAgICAgICBsb2dpbjogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vY2hlY2sgcHJvZ3Jlc3MgYW5kIHVwZGF0ZSBwcm9ncmVzc2JhciB2YWx1ZVxuICAgICAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm1Qcm9ncmVzcyA9IDA7XG4gICAgICAgICAgICBfLmVhY2godGhpcy5mb3JtSW5wdXRzLCBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlmKGlucHV0LmlzVmFsaWQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzKys7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuJHByb2dyZXNzLnZhbCh0aGlzLmZvcm1Qcm9ncmVzcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7IFxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
