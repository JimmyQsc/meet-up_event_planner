function validateOnSubmit(e){_.each(e,function(e){e.validateInput(),e.input[0].setCustomValidity(e.getMessage())})}var app=app||{};!function(){app.Event=Backbone.Model.extend({defaults:{name:"",type:"",host:"",startTime:"",endTime:"",guestList:"Coolest people on earth",location:"",extraInfo:"No additional information",color:"#fec000"}})}();var app=app||{};!function(){app.User=Backbone.Model.extend({defaults:{login:!1,userName:"",userEmail:"",userPwd:""},localStorage:new Backbone.LocalStorage("user")})}(),$(function(){var e=new app.User({id:1}),t=new app.RegisterView({model:e});new app.MainView;var s=$("#submit");s.click(function(){validateOnSubmit(t.formInputs)})});var app=app||{};!function(){app.EventsCollection=Backbone.Collection.extend({model:app.Event,localStorage:new Backbone.LocalStorage("events")}),app.events=new app.EventsCollection}();var app=app||{};!function(){var e=Backbone.Router.extend({routes:{"":"defaultView","list-events":"listEvents"},defaultView:function(){$(".event-form").addClass("open"),$(".events-view").removeClass("open"),$(".addEvent").addClass("current"),$(".listEvent").removeClass("current"),$("#event-name").focus()},listEvents:function(){$(".event-form").removeClass("open"),$(".events-view").addClass("open"),$(".addEvent").removeClass("current"),$(".listEvent").addClass("current")}});app.router=new e,Backbone.history.start()}();var app=app||{};!function(){var e=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,t=/^[a-z]+$/i,s=/^[a-z0-9]+$/i,n=/^\s+$/,r=/^[a-zA-Z ]*$/;app.FormErrorMessages={required:"This field is required.",validEmail:"The email address is not valid.",minLength:"This field must contain at least %s characters.",maxLength:"This field must not exceed %s characters in length.",alpha:"This field must only contain alphabetical characters.",alphaNumeric:"This field must only contain alpha-numeric characters.",hasNumber:"This field must contain number.",hasLetter:"This field must contain letter.",nameWithSpace:"This field must only contain alphabetical characters and space between.",laterThanNow:"This should happen at a later time"},app.FormErrorChecker={required:function(e){return n.test(e)?app.FormErrorMessages.required:e.length<1?app.FormErrorMessages.required:""},validEmail:function(t){return e.test(t)?"":app.FormErrorMessages.validEmail},minLength:function(e){return function(t){return t.length<e?app.FormErrorMessages.minLength.replace("%s",e):""}},maxLength:function(e){return function(t){return t.length>e?app.FormErrorMessages.maxLength.replace("%s",e):""}},alpha:function(e){return t.test(e)?"":app.FormErrorMessages.alpha},alphaNumeric:function(e){return s.test(e)?"":app.FormErrorMessages.alphaNumeric},hasNumber:function(e){return e.match(/\d/g)?"":app.FormErrorMessages.hasNumber},hasLetter:function(e){return e.match(/[a-z,A-z]/g)?"":app.FormErrorMessages.hasLetter},nameWithSpace:function(e){return r.test(e)?"":app.FormErrorMessages.nameWithSpace},laterThanNow:function(e){if(e)return Date.parse(e)<(new Date).getTime()?app.FormErrorMessages.laterThanNow:""}}}();var SuperInput=function(e){this.input=e,this.requirements=[],this.isValid=!1,this.alertEl=e.parent().find(".alert")};SuperInput.prototype={getInputValue:function(){return this.input.val()},addMessage:function(e){this.messages.push(e)},getMessage:function(){var e="";return this.messages.length>0&&(e=this.messages.join(". \n")),e},validateInput:function(){var e=this.getInputValue();this.messages=[],_.each(this.requirements,function(t){var s=t(e);s&&this.addMessage(s)},this),this.messages.length?this.isValid=!1:this.isValid=!0},checkOnChange:function(){var e=this;return this.input.on("change blur",function(){e.validateInput(),e.alert()}),e},checkOnKeyup:function(){var e=this;return this.input.on("keyup",function(){e.validateInput(),e.alert()}),e},alert:function(){this.isValid?(this.alertEl.html(""),this.input.removeClass("invalid")):(this.alertEl.html(this.getMessage()),this.input.addClass("invalid"))}};var app=app||{};!function(e){app.EventView=Backbone.View.extend({tagName:"li",className:"event",template:_.template(e("#event-template").html()),intialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.model.get("color");return this.$el.css({background:e,"border-color":e}),this}})}(jQuery);var app=app||{};!function(e){app.MainView=Backbone.View.extend({el:".planer-app",events:{"click #add":"validate","submit #add-event":"createEvent","change input, textarea":"progress"},initialize:function(){this.$list=e(".event-list"),this.$eventsView=e(".events-view"),this.$eventForm=e(".event-form"),this.$progress=e("#e-f-p"),this.formProgress=1,this.eventHost=new SuperInput(e("#event-host")),this.endTime=new SuperInput(e("#end-time")),this.guestList=new SuperInput(e("#guest-list")),this.extraInfo=new SuperInput(e("#extra-info")),this.eventColor=new SuperInput(e("#event-color")),this.eventName=new SuperInput(e("#event-name")),this.eventType=new SuperInput(e("#event-type")),this.startTime=new SuperInput(e("#start-time")),this.eventLocation=new SuperInput(e("#event-location")),this.requiredInputs=[this.eventName,this.eventType,this.eventHost,this.eventLocation,this.guestList,this.startTime,this.endTime],_.each(this.requiredInputs,function(e){e.requirements.push(app.FormErrorChecker.required),e.checkOnChange()}),this.startTime.requirements.push(app.FormErrorChecker.laterThanNow),this.endTime.requirements.push(app.FormErrorChecker.laterThanNow,function(t){var s=e("#start-time").val();if(t)return Date.parse(t)<=Date.parse(s)?"This should happen later than start time":""}),this.$form=e("#add-event"),e("#event-color").val("#FECE00"),this.appHeight=this.$eventForm[0].offsetHeight,this.listenTo(app.events,"add",this.appendItem),app.events.fetch(),this.render()},render:function(){this.$eventsView.css("margin-top",-this.appHeight),this.$eventsView.css("height",this.appHeight)},appendItem:function(e){var t=new app.EventView({model:e});this.$list.append(t.render().el)},validate:function(){validateOnSubmit(this.requiredInputs)},createEvent:function(){return app.events.create({name:this.eventName.getInputValue(),type:this.eventType.getInputValue(),host:this.eventHost.getInputValue(),startTime:this.startTime.getInputValue(),endTime:this.endTime.getInputValue(),guestList:this.eventLocation.getInputValue(),location:this.guestList.getInputValue(),extraInfo:this.extraInfo.getInputValue(),color:this.eventColor.getInputValue()}),this.resetForm(),!1},resetForm:function(){this.$form[0].reset(),this.$progress.val(0),e("#event-color").val("#FECE00")},progress:function(){this.formProgress=0,_.each(this.requiredInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}})}(jQuery);var app=app||{};!function(e){app.RegisterView=Backbone.View.extend({el:".user-state",events:{"click #regist-btn":"showRegist","submit #registration":"saveUser","change input":"updateProgress"},template:_.template(e("#user-template").html()),initialize:function(){this.formLayer=e(".regist"),this.registBtn=e("#regist-btn"),this.$userInfo=e("#user"),this.form=e("#registration"),this.jobTitle=e("#jobTitle"),this.submitBtn=e("#submit"),this.$progress=e("#r-f-p"),this.formProgress=0,this.sNameInput=new SuperInput(e("#name")),this.sNameInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.nameWithSpace],this.sEmailInput=new SuperInput(e("#email")),this.sEmailInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.validEmail],this.sPwdInput=new SuperInput(e("#password")),this.sPwdInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.minLength(6),app.FormErrorChecker.maxLength(16),app.FormErrorChecker.alphaNumeric,app.FormErrorChecker.hasNumber,app.FormErrorChecker.hasLetter],this.formInputs=[this.sNameInput,this.sEmailInput,this.sPwdInput],this.sNameInput.checkOnChange(),this.sEmailInput.checkOnChange(),this.sPwdInput.checkOnChange().checkOnKeyup(),e(".regist-form").click(function(e){e.stopPropagation()}),e(".regist, .close-form").click(function(){e(".regist").hide(),e("#event-name").focus()}),this.listenTo(this.model,"change",this.render),this.model.fetch(),this.render()},render:function(){this.updateProgress(),this.model.get("login")?(this.formLayer.hide(),this.registBtn.hide(),e("#event-name").focus(),this.$userInfo.html(this.template({name:this.model.get("userName")}))):(this.formLayer.show(),this.sNameInput.input.focus(),this.registBtn.show())},showRegist:function(){this.render()},saveUser:function(){this.model.save({userName:this.sNameInput.getInputValue(),userEmail:this.sEmailInput.getInputValue(),userPwd:this.sPwdInput.getInputValue(),jboTitle:this.jobTitle.val(),login:!0})},updateProgress:function(){this.formProgress=0,_.each(this.formInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}})}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRpb24vdmFsaWRhdGlvbi5qcyIsImV2ZW50LmpzIiwidXNlci5qcyIsImNvbGxlY3Rpb25zL2V2ZW50cy5qcyIsInJvdXRlci9yb3V0ZXIuanMiLCJ2aWV3cy9ldmVudC5qcyIsInZpZXdzL21haW5WaWV3LmpzIiwidmlld3MvcmVnaXN0ZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGVPblN1Ym1pdCIsInNJbnB1dHMiLCJfIiwiZWFjaCIsInNJbnB1dCIsInZhbGlkYXRlSW5wdXQiLCJpbnB1dCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZ2V0TWVzc2FnZSIsImFwcCIsIkV2ZW50IiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwibmFtZSIsInR5cGUiLCJob3N0Iiwic3RhcnRUaW1lIiwiZW5kVGltZSIsImd1ZXN0TGlzdCIsImxvY2F0aW9uIiwiZXh0cmFJbmZvIiwiY29sb3IiLCJVc2VyIiwibG9naW4iLCJ1c2VyTmFtZSIsInVzZXJFbWFpbCIsInVzZXJQd2QiLCJsb2NhbFN0b3JhZ2UiLCJMb2NhbFN0b3JhZ2UiLCIkIiwidXNlciIsImlkIiwicmVnaXN0ZXIiLCJSZWdpc3RlclZpZXciLCJtb2RlbCIsIk1haW5WaWV3Iiwic3VibWl0QnRuIiwiY2xpY2siLCJmb3JtSW5wdXRzIiwiRXZlbnRzQ29sbGVjdGlvbiIsIkNvbGxlY3Rpb24iLCJldmVudHMiLCJSb3V0ZXIiLCJyb3V0ZXMiLCIiLCJsaXN0LWV2ZW50cyIsImRlZmF1bHRWaWV3IiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImZvY3VzIiwibGlzdEV2ZW50cyIsInJvdXRlciIsImhpc3RvcnkiLCJzdGFydCIsImVtYWlsUmVnZXgiLCJhbHBoYVJlZ2V4IiwiYWxwaGFOdW1lcmljUmVnZXgiLCJzcGFjZVJlZ2V4IiwibmFtZVJlZ2V4IiwiRm9ybUVycm9yTWVzc2FnZXMiLCJyZXF1aXJlZCIsInZhbGlkRW1haWwiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJhbHBoYSIsImFscGhhTnVtZXJpYyIsImhhc051bWJlciIsImhhc0xldHRlciIsIm5hbWVXaXRoU3BhY2UiLCJsYXRlclRoYW5Ob3ciLCJGb3JtRXJyb3JDaGVja2VyIiwidmFsdWUiLCJ0ZXN0IiwibGVuZ3RoIiwicmVwbGFjZSIsIm1hdGNoIiwiRGF0ZSIsInBhcnNlIiwiZ2V0VGltZSIsIlN1cGVySW5wdXQiLCJ0aGlzIiwicmVxdWlyZW1lbnRzIiwiaXNWYWxpZCIsImFsZXJ0RWwiLCJwYXJlbnQiLCJmaW5kIiwicHJvdG90eXBlIiwiZ2V0SW5wdXRWYWx1ZSIsInZhbCIsImFkZE1lc3NhZ2UiLCJtZXNzYWdlIiwibWVzc2FnZXMiLCJwdXNoIiwiam9pbiIsInJlcXVpcmVtZW50IiwibXNnIiwiY2hlY2tPbkNoYW5nZSIsInNlbGYiLCJvbiIsImFsZXJ0IiwiY2hlY2tPbktleXVwIiwiaHRtbCIsIkV2ZW50VmlldyIsIlZpZXciLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwidGVtcGxhdGUiLCJpbnRpYWxpemUiLCJsaXN0ZW5UbyIsInJlbmRlciIsIiRlbCIsImF0dHJpYnV0ZXMiLCJldmVudENvbG9yIiwiZ2V0IiwiY3NzIiwiYmFja2dyb3VuZCIsImJvcmRlci1jb2xvciIsImpRdWVyeSIsImVsIiwiY2xpY2sgI2FkZCIsInN1Ym1pdCAjYWRkLWV2ZW50IiwiY2hhbmdlIGlucHV0LCB0ZXh0YXJlYSIsImluaXRpYWxpemUiLCIkbGlzdCIsIiRldmVudHNWaWV3IiwiJGV2ZW50Rm9ybSIsIiRwcm9ncmVzcyIsImZvcm1Qcm9ncmVzcyIsImV2ZW50SG9zdCIsImV2ZW50TmFtZSIsImV2ZW50VHlwZSIsImV2ZW50TG9jYXRpb24iLCJyZXF1aXJlZElucHV0cyIsIiRmb3JtIiwiYXBwSGVpZ2h0Iiwib2Zmc2V0SGVpZ2h0IiwiYXBwZW5kSXRlbSIsImZldGNoIiwiZXZlbnQiLCJ2aWV3IiwiYXBwZW5kIiwidmFsaWRhdGUiLCJjcmVhdGVFdmVudCIsImNyZWF0ZSIsInJlc2V0Rm9ybSIsInJlc2V0IiwicHJvZ3Jlc3MiLCJjbGljayAjcmVnaXN0LWJ0biIsInN1Ym1pdCAjcmVnaXN0cmF0aW9uIiwiY2hhbmdlIGlucHV0IiwiZm9ybUxheWVyIiwicmVnaXN0QnRuIiwiJHVzZXJJbmZvIiwiZm9ybSIsImpvYlRpdGxlIiwic05hbWVJbnB1dCIsInNFbWFpbElucHV0Iiwic1B3ZElucHV0IiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsImhpZGUiLCJ1cGRhdGVQcm9ncmVzcyIsInNob3ciLCJzaG93UmVnaXN0Iiwic2F2ZVVzZXIiLCJzYXZlIiwiamJvVGl0bGUiXSwibWFwcGluZ3MiOiJBQStLQSxRQUFBQSxrQkFBQUMsR0FDQUMsRUFBQUMsS0FBQUYsRUFBQSxTQUFBRyxHQUNBQSxFQUFBQyxnQkFDQUQsRUFBQUUsTUFBQSxHQUFBQyxrQkFBQUgsRUFBQUksZ0JDbExBLEdBQUFDLEtBQUFBLFNBR0EsV0FDQUEsSUFBQUMsTUFBQUMsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQUMsS0FBQSxHQUNBQyxLQUFBLEdBQ0FDLEtBQUEsR0FDQUMsVUFBQSxHQUNBQyxRQUFBLEdBQ0FDLFVBQUEsMEJBQ0FDLFNBQUEsR0FDQUMsVUFBQSw0QkFDQUMsTUFBQSxlQ2RBLElBQUFkLEtBQUFBLFNBRUEsV0FDQUEsSUFBQWUsS0FBQWIsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQVcsT0FBQSxFQUNBQyxTQUFBLEdBQ0FDLFVBQUEsR0FDQUMsUUFBQSxJQUdBQyxhQUFBLEdBQUFsQixVQUFBbUIsYUFBQSxhRFhBQyxFQUFBLFdBRUEsR0FBQUMsR0FBQSxHQUFBdkIsS0FBQWUsTUFBQVMsR0FBQSxJQUdBQyxFQUFBLEdBQUF6QixLQUFBMEIsY0FBQUMsTUFBQUosR0FHQSxJQUFBdkIsS0FBQTRCLFFBR0EsSUFBQUMsR0FBQVAsRUFBQSxVQUdBTyxHQUFBQyxNQUFBLFdBQ0F2QyxpQkFBQWtDLEVBQUFNLGVFZkEsSUFBQS9CLEtBQUFBLFNBRUEsV0FDQUEsSUFBQWdDLGlCQUFBOUIsU0FBQStCLFdBQUE3QixRQUVBdUIsTUFBQTNC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PSBhcHAgfHwge307XG5cbihmdW5jdGlvbigpIHtcbiAgICAvL3JlZ3VsYXIgZXhwcmVzc2lvbnNcbiAgICB2YXIgZW1haWxSZWdleCA9IC9eW2EtekEtWjAtOS4hIyQlJicqKy89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KD86XFwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSokLyxcbiAgICAgICAgYWxwaGFSZWdleCA9IC9eW2Etel0rJC9pLFxuICAgICAgICBhbHBoYU51bWVyaWNSZWdleCA9IC9eW2EtejAtOV0rJC9pLFxuICAgICAgICBzcGFjZVJlZ2V4ID0gL15cXHMrJC8sXG4gICAgICAgIG5hbWVSZWdleCA9IC9eW2EtekEtWiBdKiQvO1xuXG4gICAgLy9tZXNzYWdlcyB3aGVuIHJlcXVpcmVtZW50IGRvZXNuJ3QgcGFzc1xuICAgIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcyA9IHtcbiAgICAgICAgcmVxdWlyZWQ6ICdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLicsXG4gICAgICAgIHZhbGlkRW1haWw6ICdUaGUgZW1haWwgYWRkcmVzcyBpcyBub3QgdmFsaWQuJyxcbiAgICAgICAgbWluTGVuZ3RoOiAnVGhpcyBmaWVsZCBtdXN0IGNvbnRhaW4gYXQgbGVhc3QgJXMgY2hhcmFjdGVycy4nLFxuICAgICAgICBtYXhMZW5ndGg6ICdUaGlzIGZpZWxkIG11c3Qgbm90IGV4Y2VlZCAlcyBjaGFyYWN0ZXJzIGluIGxlbmd0aC4nLFxuICAgICAgICBhbHBoYTogJ1RoaXMgZmllbGQgbXVzdCBvbmx5IGNvbnRhaW4gYWxwaGFiZXRpY2FsIGNoYXJhY3RlcnMuJyxcbiAgICAgICAgYWxwaGFOdW1lcmljOiAnVGhpcyBmaWVsZCBtdXN0IG9ubHkgY29udGFpbiBhbHBoYS1udW1lcmljIGNoYXJhY3RlcnMuJyxcbiAgICAgICAgaGFzTnVtYmVyOiAnVGhpcyBmaWVsZCBtdXN0IGNvbnRhaW4gbnVtYmVyLicsXG4gICAgICAgIGhhc0xldHRlcjogJ1RoaXMgZmllbGQgbXVzdCBjb250YWluIGxldHRlci4nLFxuICAgICAgICBuYW1lV2l0aFNwYWNlOiAnVGhpcyBmaWVsZCBtdXN0IG9ubHkgY29udGFpbiBhbHBoYWJldGljYWwgY2hhcmFjdGVycyBhbmQgc3BhY2UgYmV0d2Vlbi4nLFxuICAgICAgICBsYXRlclRoYW5Ob3c6ICdUaGlzIHNob3VsZCBoYXBwZW4gYXQgYSBsYXRlciB0aW1lJ1xuICAgIH07XG5cbiAgICAvL21ldGhvZHMgdG8gdmFsaWRhdGUgdGhlIGlucHV0IHZhbHVlXG4gICAgYXBwLkZvcm1FcnJvckNoZWNrZXIgPSB7XG4gICAgICAgIHJlcXVpcmVkOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgLy9jaGVjayBpZiB0aGUgdmFsdWUgb25seSBjb3RhaW5zIHNwYWNlc1xuICAgICAgICAgICAgaWYgKHNwYWNlUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLnJlcXVpcmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aDwxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5yZXF1aXJlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgdmFsaWRFbWFpbDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghZW1haWxSZWdleC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMudmFsaWRFbWFpbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgbWluTGVuZ3RoOiBmdW5jdGlvbihsZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5taW5MZW5ndGgucmVwbGFjZSgnJXMnLCBsZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBtYXhMZW5ndGg6IGZ1bmN0aW9uKGxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLm1heExlbmd0aC5yZXBsYWNlKCclcycsIGxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGFscGhhOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCFhbHBoYVJlZ2V4LnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5hbHBoYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgYWxwaGFOdW1lcmljOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCFhbHBoYU51bWVyaWNSZWdleC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMuYWxwaGFOdW1lcmljO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9LFxuICAgICAgICBoYXNOdW1iZXI6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZhbHVlLm1hdGNoKC9cXGQvZykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLmhhc051bWJlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgaGFzTGV0dGVyOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2YWx1ZS5tYXRjaCgvW2EteixBLXpdL2cpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5oYXNMZXR0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIG5hbWVXaXRoU3BhY2U6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIW5hbWVSZWdleC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMubmFtZVdpdGhTcGFjZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgbGF0ZXJUaGFuTm93OiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKERhdGUucGFyc2UodmFsdWUpIDwgbmV3IERhdGUoKS5nZXRUaW1lKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5sYXRlclRoYW5Ob3c7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59KSgpO1xuXG4vKipcbiAqIE1ha2UgYSBpbnB1dCB0byBhIFN1cGVySW5wdXQgdG8gdmFsaWRhdGUgaXRzIHZhbHVlXG4gKi9cbnZhciBTdXBlcklucHV0ID0gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gICAgdGhpcy5yZXF1aXJlbWVudHMgPSBbXTtcbiAgICB0aGlzLmlzVmFsaWQgPSBmYWxzZTtcbiAgICB0aGlzLmFsZXJ0RWwgPSBpbnB1dC5wYXJlbnQoKS5maW5kKCcuYWxlcnQnKTtcbn1cblxuU3VwZXJJbnB1dC5wcm90b3R5cGUgPSB7XG4gICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlucHV0LnZhbCgpO1xuICAgIH0sXG5cbiAgICBhZGRNZXNzYWdlIDogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gICAgfSxcblxuICAgIGdldE1lc3NhZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbWVzc2FnZSA9ICcnO1xuICAgICAgICBpZih0aGlzLm1lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSB0aGlzLm1lc3NhZ2VzLmpvaW4oJy4gXFxuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfSxcblxuICAgIHZhbGlkYXRlSW5wdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmdldElucHV0VmFsdWUoKTtcbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuXG4gICAgICAgIF8uZWFjaCh0aGlzLnJlcXVpcmVtZW50cywgZnVuY3Rpb24ocmVxdWlyZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBtc2cgPSByZXF1aXJlbWVudCh2YWx1ZSk7XG4gICAgICAgICAgICBpZihtc2cpe1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShtc2cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAodGhpcy5tZXNzYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjaGVja09uQ2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmlucHV0Lm9uKCdjaGFuZ2UgYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi52YWxpZGF0ZUlucHV0KCk7XG4gICAgICAgICAgICBzZWxmLmFsZXJ0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2VsZjtcbiAgICB9LFxuXG4gICAgY2hlY2tPbktleXVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmlucHV0Lm9uKCdrZXl1cCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi52YWxpZGF0ZUlucHV0KCk7XG4gICAgICAgICAgICBzZWxmLmFsZXJ0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2VsZjtcbiAgICB9LFxuXG4gICAgYWxlcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCkge1xuICAgICAgICAgICAgdGhpcy5hbGVydEVsLmh0bWwodGhpcy5nZXRNZXNzYWdlKCkpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5hZGRDbGFzcygnaW52YWxpZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hbGVydEVsLmh0bWwoJycpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5yZW1vdmVDbGFzcygnaW52YWxpZCcpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuXG4vL3ZhbGlkYXRlIHdoZW4gc3VibWl0dGluZyB0aGUgZm9ybVxuZnVuY3Rpb24gdmFsaWRhdGVPblN1Ym1pdChzSW5wdXRzKSB7XG4gICAgXy5lYWNoKHNJbnB1dHMsIGZ1bmN0aW9uKHNJbnB1dCkge1xuICAgICAgICBzSW5wdXQudmFsaWRhdGVJbnB1dCgpO1xuICAgICAgICBzSW5wdXQuaW5wdXRbMF0uc2V0Q3VzdG9tVmFsaWRpdHkoc0lucHV0LmdldE1lc3NhZ2UoKSk7XG4gICAgfSk7XG59IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuLy9Nb2RlbCBmb3IgYSBldmVudFxuKGZ1bmN0aW9uKCkge1xuICAgIGFwcC5FdmVudCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgIHR5cGU6ICcnLFxuICAgICAgICAgICAgaG9zdDogJycsXG4gICAgICAgICAgICBzdGFydFRpbWU6ICcnLFxuICAgICAgICAgICAgZW5kVGltZTogJycsXG4gICAgICAgICAgICBndWVzdExpc3Q6ICdDb29sZXN0IHBlb3BsZSBvbiBlYXJ0aCcsXG4gICAgICAgICAgICBsb2NhdGlvbjogJycsXG4gICAgICAgICAgICBleHRyYUluZm86J05vIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24nLFxuICAgICAgICAgICAgY29sb3I6ICcjZmVjMDAwJ1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKCkge1xuICAgIGFwcC5Vc2VyID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgIGxvZ2luOiBmYWxzZSxcbiAgICAgICAgICAgIHVzZXJOYW1lOiAnJyxcbiAgICAgICAgICAgIHVzZXJFbWFpbDogJycsXG4gICAgICAgICAgICB1c2VyUHdkOiAnJ1xuICAgICAgICB9LFxuICAgICAgICAvL3NhdmluZyB1c2VyIGluZm8gdG8gbG9jYWwgc3RvcmFnZVxuICAgICAgICBsb2NhbFN0b3JhZ2U6IG5ldyBCYWNrYm9uZS5Mb2NhbFN0b3JhZ2UoJ3VzZXInKSxcbiAgICB9KTtcbn0pKCk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgYXBwLkV2ZW50c0NvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7XG4gICAgICAgIC8vcmVmZXJlbmNlIHRvIGl0cyBtb2RlbFxuICAgICAgICBtb2RlbDogYXBwLkV2ZW50LFxuICAgICAgICBsb2NhbFN0b3JhZ2U6IG5ldyBCYWNrYm9uZS5Mb2NhbFN0b3JhZ2UoJ2V2ZW50cycpLFxuICAgIH0pO1xuICAgIFxuICAgIGFwcC5ldmVudHMgPSBuZXcgYXBwLkV2ZW50c0NvbGxlY3Rpb24oKTtcbn0pKCk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgLyoqXG4gICAgICogVGhlIHJvdXRlciBtYWtlIHN1cmUgdGhlIHVybCBjaGFuZ2Ugd2lsbCBjaGFuZ2UgdGhlIGFwcCdzIHZpZXcsIHRoZSByaWdodCB1cmxcbiAgICAgKiBhbHdheXMgYnJpbmdzIHRoZSByaWdodCB2aWV3XG4gICAgICovXG4gICAgdmFyIFJvdXRlciA9IEJhY2tib25lLlJvdXRlci5leHRlbmQoe1xuICAgICAgICByb3V0ZXM6IHtcbiAgICAgICAgICAgICcnOiAnZGVmYXVsdFZpZXcnLFxuICAgICAgICAgICAgJ2xpc3QtZXZlbnRzJzogJ2xpc3RFdmVudHMnXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9tYWtlIHN1cmUgdGhlIHJpZ2h0IHZpZXcgaXMgb3BlblxuICAgICAgICBkZWZhdWx0VmlldzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuZXZlbnQtZm9ybScpLmFkZENsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICAkKCcuZXZlbnRzLXZpZXcnKS5yZW1vdmVDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgJCgnLmFkZEV2ZW50JykuYWRkQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgICAgICQoJy5saXN0RXZlbnQnKS5yZW1vdmVDbGFzcygnY3VycmVudCcpO1xuICAgICAgICAgICAgJCgnI2V2ZW50LW5hbWUnKS5mb2N1cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxpc3RFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLmV2ZW50LWZvcm0nKS5yZW1vdmVDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgJCgnLmV2ZW50cy12aWV3JykuYWRkQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICQoJy5hZGRFdmVudCcpLnJlbW92ZUNsYXNzKCdjdXJyZW50Jyk7XG4gICAgICAgICAgICAkKCcubGlzdEV2ZW50JykuYWRkQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYXBwLnJvdXRlciA9IG5ldyBSb3V0ZXIoKTtcbiAgICBCYWNrYm9uZS5oaXN0b3J5LnN0YXJ0KCk7XG59KSgpO1xuIiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKCQpIHtcbiAgICBhcHAuRXZlbnRWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgICAgICB0YWdOYW1lOiAnbGknLFxuXG4gICAgICAgIGNsYXNzTmFtZTogJ2V2ZW50JyxcbiAgICAgICAgLy90ZW1wbGF0ZSB0byByZW5kZXIgYSBldmVudFxuICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgkKCcjZXZlbnQtdGVtcGxhdGUnKS5odG1sKCkpLFxuXG4gICAgICAgIC8vbGlzdGVuIHRvIG1vZGVsIGV2ZW50IGluIGluaXRpYWxpemF0aW9uXG4gICAgICAgIGludGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsICdjaGFuZ2UnLCB0aGlzLnJlbmRlcik7XG4gICAgICAgIH0sXG4gICAgICAgIC8vcmVuYmVyIGEgc2luZ2xlIGV2ZW50J3Mgdmlld1xuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKHRoaXMubW9kZWwuYXR0cmlidXRlcykpO1xuICAgICAgICAgICAgdmFyIGV2ZW50Q29sb3IgPSB0aGlzLm1vZGVsLmdldCgnY29sb3InKTtcbiAgICAgICAgICAgIHRoaXMuJGVsLmNzcyh7XG4gICAgICAgICAgICAgICAgJ2JhY2tncm91bmQnOiBldmVudENvbG9yLFxuICAgICAgICAgICAgICAgICdib3JkZXItY29sb3InOiBldmVudENvbG9yLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH0pO1xufSkoalF1ZXJ5KTtcbiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbigkKSB7XG4gICAgYXBwLk1haW5WaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgICAgICBlbDogJy5wbGFuZXItYXBwJyxcblxuICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgICdjbGljayAjYWRkJzogJ3ZhbGlkYXRlJyxcbiAgICAgICAgICAgICdzdWJtaXQgI2FkZC1ldmVudCc6ICdjcmVhdGVFdmVudCcsXG4gICAgICAgICAgICAnY2hhbmdlIGlucHV0LCB0ZXh0YXJlYSc6ICdwcm9ncmVzcydcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vY2FjaGUgZG9tIGVsZW1lbnRcbiAgICAgICAgICAgIHRoaXMuJGxpc3QgPSAkKCcuZXZlbnQtbGlzdCcpO1xuICAgICAgICAgICAgdGhpcy4kZXZlbnRzVmlldyA9ICQoJy5ldmVudHMtdmlldycpO1xuICAgICAgICAgICAgdGhpcy4kZXZlbnRGb3JtID0gJCgnLmV2ZW50LWZvcm0nKTtcbiAgICAgICAgICAgIHRoaXMuJHByb2dyZXNzID0gJCgnI2UtZi1wJyk7XG5cbiAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzID0gMTtcbiAgICAgICAgICAgIC8vYWxsIHRoZSBpbnB1dHNcbiAgICAgICAgICAgIHRoaXMuZXZlbnRIb3N0ID0gbmV3IFN1cGVySW5wdXQoJCgnI2V2ZW50LWhvc3QnKSk7XG4gICAgICAgICAgICB0aGlzLmVuZFRpbWUgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZW5kLXRpbWUnKSk7XG4gICAgICAgICAgICB0aGlzLmd1ZXN0TGlzdCA9IG5ldyBTdXBlcklucHV0KCQoJyNndWVzdC1saXN0JykpO1xuICAgICAgICAgICAgdGhpcy5leHRyYUluZm8gPSBuZXcgU3VwZXJJbnB1dCgkKCcjZXh0cmEtaW5mbycpKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRDb2xvciA9IG5ldyBTdXBlcklucHV0KCQoJyNldmVudC1jb2xvcicpKTtcblxuICAgICAgICAgICAgdGhpcy5ldmVudE5hbWUgPSAgbmV3IFN1cGVySW5wdXQoJCgnI2V2ZW50LW5hbWUnKSk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50VHlwZSA9IG5ldyBTdXBlcklucHV0KCQoJyNldmVudC10eXBlJykpO1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgU3VwZXJJbnB1dCgkKCcjc3RhcnQtdGltZScpKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMb2NhdGlvbiA9IG5ldyBTdXBlcklucHV0KCQoJyNldmVudC1sb2NhdGlvbicpKTtcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZWRJbnB1dHMgPSBbdGhpcy5ldmVudE5hbWUsIHRoaXMuZXZlbnRUeXBlLCB0aGlzLmV2ZW50SG9zdCwgdGhpcy5ldmVudExvY2F0aW9uLCB0aGlzLmd1ZXN0TGlzdCwgdGhpcy5zdGFydFRpbWUsIHRoaXMuZW5kVGltZV07XG4gICAgICAgICAgICAvL2ZvciBldmVyeSByZXF1aXJlZCBpbnB1dHMgYWRkIHJlcXVpcmVkIHRvIHRoZWlyIHJlcXVpcmVtZW50c1xuICAgICAgICAgICAgXy5lYWNoKHRoaXMucmVxdWlyZWRJbnB1dHMsIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgaW5wdXQucmVxdWlyZW1lbnRzLnB1c2goYXBwLkZvcm1FcnJvckNoZWNrZXIucmVxdWlyZWQpO1xuICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrT25DaGFuZ2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy90aGVzZSB0d28gbmVlZCB0byBoYXZlIGEgdGltZSBjaGVja1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUucmVxdWlyZW1lbnRzLnB1c2goYXBwLkZvcm1FcnJvckNoZWNrZXIubGF0ZXJUaGFuTm93KTtcbiAgICAgICAgICAgIHRoaXMuZW5kVGltZS5yZXF1aXJlbWVudHMucHVzaChhcHAuRm9ybUVycm9yQ2hlY2tlci5sYXRlclRoYW5Ob3csIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9ICQoJyNzdGFydC10aW1lJykudmFsKCk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChEYXRlLnBhcnNlKHZhbHVlKSA8PSBEYXRlLnBhcnNlKHN0YXJ0VGltZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnVGhpcyBzaG91bGQgaGFwcGVuIGxhdGVyIHRoYW4gc3RhcnQgdGltZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgIHRoaXMuJGZvcm0gPSAkKCcjYWRkLWV2ZW50Jyk7XG4gICAgICAgICAgICAvL3NldCB0aGUgZGVmYXVsdCBjb2xvclxuICAgICAgICAgICAgJCgnI2V2ZW50LWNvbG9yJykudmFsKCcjRkVDRTAwJyk7XG5cbiAgICAgICAgICAgIHRoaXMuYXBwSGVpZ2h0ID0gdGhpcy4kZXZlbnRGb3JtWzBdLm9mZnNldEhlaWdodDtcblxuICAgICAgICAgICAgLy9saXN0ZW4gdG8gY29sbGVjdGlvbiBldmVudFxuICAgICAgICAgICAgdGhpcy5saXN0ZW5UbyhhcHAuZXZlbnRzLCAnYWRkJywgdGhpcy5hcHBlbmRJdGVtKTtcbiAgICAgICAgICAgIC8vZmV0Y2ggZGF0YSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgICAgICAgICAgYXBwLmV2ZW50cy5mZXRjaCgpO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9kcmFnIHRoZSBldmVudHMgdmlldyB0byB0aGUgcmlnaHQgcGxhY2VcbiAgICAgICAgICAgIHRoaXMuJGV2ZW50c1ZpZXcuY3NzKCdtYXJnaW4tdG9wJywgLXRoaXMuYXBwSGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuJGV2ZW50c1ZpZXcuY3NzKCdoZWlnaHQnLCB0aGlzLmFwcEhlaWdodCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXBwZW5kSXRlbTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgdmlldyBmb3IgdGhlIGV2ZW50XG4gICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBhcHAuRXZlbnRWaWV3KHttb2RlbDogZXZlbnR9KTtcbiAgICAgICAgICAgIC8vYXBwZW5kIGl0IHRvIHRoZSBsaXN0XG4gICAgICAgICAgICB0aGlzLiRsaXN0LmFwcGVuZCh2aWV3LnJlbmRlcigpLmVsKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YWxpZGF0ZU9uU3VibWl0KHRoaXMucmVxdWlyZWRJbnB1dHMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZUV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vY3JlYXRlIGFuIGV2ZW50IG1vZGVsXG4gICAgICAgICAgICBhcHAuZXZlbnRzLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5ldmVudE5hbWUuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuZXZlbnRUeXBlLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBob3N0OiB0aGlzLmV2ZW50SG9zdC5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB0aGlzLnN0YXJ0VGltZS5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgZW5kVGltZTogdGhpcy5lbmRUaW1lLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBndWVzdExpc3Q6IHRoaXMuZXZlbnRMb2NhdGlvbi5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgbG9jYXRpb246IHRoaXMuZ3Vlc3RMaXN0LmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBleHRyYUluZm86IHRoaXMuZXh0cmFJbmZvLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5ldmVudENvbG9yLmdldElucHV0VmFsdWUoKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMucmVzZXRGb3JtKCk7XG4gICAgICAgICAgICAvL3ByZXZlbnQgcmVsb2FkIHBhZ2VcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvL3Jlc2V0IHRoZSBmb3JtXG4gICAgICAgIHJlc2V0Rm9ybTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLiRmb3JtWzBdLnJlc2V0KCk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcy52YWwoMCk7XG4gICAgICAgICAgICAkKCcjZXZlbnQtY29sb3InKS52YWwoJyNGRUNFMDAnKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvL3VwZGF0ZSB0aGUgcHJvZ3Jlc3MgYmFyXG4gICAgICAgIHByb2dyZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzID0gMDtcbiAgICAgICAgICAgIF8uZWFjaCh0aGlzLnJlcXVpcmVkSW5wdXRzLCBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlmKGlucHV0LmlzVmFsaWQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzKys7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuJHByb2dyZXNzLnZhbCh0aGlzLmZvcm1Qcm9ncmVzcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oJCkge1xuICAgIGFwcC5SZWdpc3RlclZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgICAgIGVsOiAnLnVzZXItc3RhdGUnLFxuXG4gICAgICAgIGV2ZW50czoge1xuICAgICAgICAgICAgJ2NsaWNrICNyZWdpc3QtYnRuJzogJ3Nob3dSZWdpc3QnLFxuICAgICAgICAgICAgJ3N1Ym1pdCAjcmVnaXN0cmF0aW9uJzogJ3NhdmVVc2VyJyxcbiAgICAgICAgICAgICdjaGFuZ2UgaW5wdXQnOiAndXBkYXRlUHJvZ3Jlc3MnXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy90ZW1wbGF0ZSBmb3IgdGhlIHVzZXJcbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJCgnI3VzZXItdGVtcGxhdGUnKS5odG1sKCkpLFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5mb3JtTGF5ZXIgPSAkKCcucmVnaXN0Jyk7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdEJ0biA9ICQoJyNyZWdpc3QtYnRuJyk7XG4gICAgICAgICAgICB0aGlzLiR1c2VySW5mbyA9ICQoJyN1c2VyJyk7XG5cbiAgICAgICAgICAgIC8vY2FjaGUgdXNlciByZWdpc3RyYXRpb24gZm9ybVxuICAgICAgICAgICAgdGhpcy5mb3JtID0gJCgnI3JlZ2lzdHJhdGlvbicpO1xuICAgICAgICAgICAgdGhpcy5qb2JUaXRsZSA9ICQoJyNqb2JUaXRsZScpO1xuICAgICAgICAgICAgdGhpcy5zdWJtaXRCdG4gPSAkKCcjc3VibWl0Jyk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcyA9ICQoJyNyLWYtcCcpO1xuICAgICAgICAgICAgdGhpcy5mb3JtUHJvZ3Jlc3MgPSAwO1xuICAgICAgICAgICAgLy9NYWtlIGlucHV0IHRvIFN1cGVySW5wdXQsIHVzZSBpdHMgbWV0aG9kIHRvIHZhbGlkYXRlIGlucHV0IHZhbHVlXG4gICAgICAgICAgICB0aGlzLnNOYW1lSW5wdXQgPSBuZXcgU3VwZXJJbnB1dCgkKCcjbmFtZScpKTtcbiAgICAgICAgICAgIC8vc2V0IHJlcXVpcmVtZW50cyBmb3IgZWxlbWVudFxuICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0LnJlcXVpcmVtZW50cyA9IFthcHAuRm9ybUVycm9yQ2hlY2tlci5yZXF1aXJlZCwgYXBwLkZvcm1FcnJvckNoZWNrZXIubmFtZVdpdGhTcGFjZV07XG5cbiAgICAgICAgICAgIHRoaXMuc0VtYWlsSW5wdXQgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZW1haWwnKSk7XG4gICAgICAgICAgICB0aGlzLnNFbWFpbElucHV0LnJlcXVpcmVtZW50cyA9IFthcHAuRm9ybUVycm9yQ2hlY2tlci5yZXF1aXJlZCwgYXBwLkZvcm1FcnJvckNoZWNrZXIudmFsaWRFbWFpbF07XG5cbiAgICAgICAgICAgIHRoaXMuc1B3ZElucHV0ID0gbmV3IFN1cGVySW5wdXQoJCgnI3Bhc3N3b3JkJykpO1xuICAgICAgICAgICAgdGhpcy5zUHdkSW5wdXQucmVxdWlyZW1lbnRzID0gW2FwcC5Gb3JtRXJyb3JDaGVja2VyLnJlcXVpcmVkLCBhcHAuRm9ybUVycm9yQ2hlY2tlci5taW5MZW5ndGgoNiksIGFwcC5Gb3JtRXJyb3JDaGVja2VyLm1heExlbmd0aCgxNiksIGFwcC5Gb3JtRXJyb3JDaGVja2VyLmFscGhhTnVtZXJpYywgYXBwLkZvcm1FcnJvckNoZWNrZXIuaGFzTnVtYmVyLCBhcHAuRm9ybUVycm9yQ2hlY2tlci5oYXNMZXR0ZXJdO1xuXG4gICAgICAgICAgICB0aGlzLmZvcm1JbnB1dHMgPSBbdGhpcy5zTmFtZUlucHV0LCB0aGlzLnNFbWFpbElucHV0LCB0aGlzLnNQd2RJbnB1dF07XG4gICAgICAgICAgICAvL3ZhbGlkYXRlIGlucHV0IHdoZW4gaW5wdXQgdmFsdWUgY2hhbmdlc1xuICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0LmNoZWNrT25DaGFuZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuc0VtYWlsSW5wdXQuY2hlY2tPbkNoYW5nZSgpO1xuICAgICAgICAgICAgLy92YWxpZGF0ZSBwYXNzd29yZCBvbiBldmVyeSBrZXl1cFxuICAgICAgICAgICAgdGhpcy5zUHdkSW5wdXQuY2hlY2tPbkNoYW5nZSgpLmNoZWNrT25LZXl1cCgpO1xuXG4gICAgICAgICAgICAvL2Nsb3NlIHRoZSBmb3JtIHdoZW4gdXNlciBjbGljayBvdXRzaWRlIHRoZSBmb3JtIG9yIHVzZXIgY2xpY2tzIHRoZSBjbG9zZSBidXR0b25cbiAgICAgICAgICAgICQoJy5yZWdpc3QtZm9ybScpLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5yZWdpc3QsIC5jbG9zZS1mb3JtJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCgnLnJlZ2lzdCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcjZXZlbnQtbmFtZScpLmZvY3VzKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9yZW1vdmUgdGhlIGRvbSBlbGVtZW50XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsICdjaGFuZ2UnLCB0aGlzLnJlbmRlcik7XG4gICAgICAgICAgICAvL2ZldGNoIGRhdGEgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICAgICAgICAgIHRoaXMubW9kZWwuZmV0Y2goKTtcbiAgICAgICAgICAgIC8vcmVuZGVyIHRoZSB2aWV3IGZvciB0aGUgZmlyc3QgdGltZVxuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcygpO1xuICAgICAgICAgICAgLy9pZiBubyB1c2VyIGxvZ2VkIGluIG9wZW4gdGVoIHJlZ2lzdGVyIGZvcm1cbiAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ2xvZ2luJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1MYXllci5zaG93KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0LmlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RCdG4uc2hvdygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1MYXllci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RCdG4uaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoJyNldmVudC1uYW1lJykuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR1c2VySW5mby5odG1sKHRoaXMudGVtcGxhdGUoe25hbWU6IHRoaXMubW9kZWwuZ2V0KCd1c2VyTmFtZScpfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8vc2hvdyB0aGUgcmVnaXN0ZXIgZm9ybVxuICAgICAgICBzaG93UmVnaXN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9zYXZlIHVzZXIgZGF0YVxuICAgICAgICBzYXZlVXNlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoe1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiB0aGlzLnNOYW1lSW5wdXQuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIHVzZXJFbWFpbDogdGhpcy5zRW1haWxJbnB1dC5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgdXNlclB3ZDogdGhpcy5zUHdkSW5wdXQuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIGpib1RpdGxlOiB0aGlzLmpvYlRpdGxlLnZhbCgpLCBcbiAgICAgICAgICAgICAgICBsb2dpbjogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vY2hlY2sgcHJvZ3Jlc3MgYW5kIHVwZGF0ZSBwcm9ncmVzc2JhciB2YWx1ZVxuICAgICAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm1Qcm9ncmVzcyA9IDA7XG4gICAgICAgICAgICBfLmVhY2godGhpcy5mb3JtSW5wdXRzLCBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlmKGlucHV0LmlzVmFsaWQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzKys7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuJHByb2dyZXNzLnZhbCh0aGlzLmZvcm1Qcm9ncmVzcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7IFxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
