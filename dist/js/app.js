function validateOnSubmit(e){_.each(e,function(e){e.validateInput(),e.input[0].setCustomValidity(e.getMessage())})}var app=app||{};!function(){app.Event=Backbone.Model.extend({defaults:{name:"",type:"",host:"",startTime:"",endTime:"",guestList:"Coolest people on earth",location:"",extraInfo:"No additional information",color:"#fec000"}})}();var app=app||{};!function(){app.User=Backbone.Model.extend({defaults:{login:!1,userName:"",userEmail:"",userPwd:""},localStorage:new Backbone.LocalStorage("user")})}(),$(function(){var e=new app.User({id:1}),t=new app.RegisterView({model:e});new app.MainView;var s=$("#submit");s.click(function(){validateOnSubmit(t.formInputs)})});var app=app||{};!function(){app.EventsCollection=Backbone.Collection.extend({model:app.Event,localStorage:new Backbone.LocalStorage("events")}),app.events=new app.EventsCollection}();var app=app||{};!function(){var e=Backbone.Router.extend({routes:{"":"defaultView","list-events":"listEvents"},defaultView:function(){$(".event-form").addClass("open"),$(".events-view").removeClass("open"),$(".addEvent").addClass("current"),$(".listEvent").removeClass("current"),$("#event-name").focus()},listEvents:function(){$(".event-form").removeClass("open"),$(".events-view").addClass("open"),$(".addEvent").removeClass("current"),$(".listEvent").addClass("current")}});app.router=new e,Backbone.history.start()}();var app=app||{};!function(e){app.EventView=Backbone.View.extend({tagName:"li",className:"event",template:_.template(e("#event-template").html()),intialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.model.get("color");return this.$el.css({background:e,"border-color":e}),this}})}(jQuery);var app=app||{};!function(e){app.MainView=Backbone.View.extend({el:".planer-app",events:{"click #add":"validate","submit #add-event":"createEvent","change input, textarea":"progress"},initialize:function(){this.$list=e(".event-list"),this.$eventsView=e(".events-view"),this.$eventForm=e(".event-form"),this.$progress=e("#e-f-p"),this.formProgress=1,this.eventHost=new SuperInput(e("#event-host")),this.endTime=new SuperInput(e("#end-time")),this.guestList=new SuperInput(e("#guest-list")),this.extraInfo=new SuperInput(e("#extra-info")),this.eventColor=new SuperInput(e("#event-color")),this.eventName=new SuperInput(e("#event-name")),this.eventType=new SuperInput(e("#event-type")),this.startTime=new SuperInput(e("#start-time")),this.eventLocation=new SuperInput(e("#event-location")),this.requiredInputs=[this.eventName,this.eventType,this.eventHost,this.eventLocation,this.guestList,this.startTime,this.endTime],_.each(this.requiredInputs,function(e){e.requirements.push(app.FormErrorChecker.required),e.checkOnChange()}),this.startTime.requirements.push(app.FormErrorChecker.laterThanNow),this.endTime.requirements.push(app.FormErrorChecker.laterThanNow,function(t){var s=e("#start-time").val();if(t)return Date.parse(t)<=Date.parse(s)?"This should happen later than start time":""}),this.$form=e("#add-event"),e("#event-color").val("#FECE00"),this.appHeight=this.$eventForm[0].offsetHeight,this.listenTo(app.events,"add",this.appendItem),app.events.fetch(),this.render()},render:function(){this.$eventsView.css("margin-top",-this.appHeight),this.$eventsView.css("height",this.appHeight)},appendItem:function(e){var t=new app.EventView({model:e});this.$list.append(t.render().el)},validate:function(){validateOnSubmit(this.requiredInputs)},createEvent:function(){return app.events.create({name:this.eventName.getInputValue(),type:this.eventType.getInputValue(),host:this.eventHost.getInputValue(),startTime:this.startTime.getInputValue(),endTime:this.endTime.getInputValue(),guestList:this.eventLocation.getInputValue(),location:this.guestList.getInputValue(),extraInfo:this.extraInfo.getInputValue(),color:this.eventColor.getInputValue()}),this.resetForm(),!1},resetForm:function(){this.$form[0].reset(),this.$progress.val(0),e("#event-color").val("#FECE00")},progress:function(){this.formProgress=0,_.each(this.requiredInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}})}(jQuery);var app=app||{};!function(e){app.RegisterView=Backbone.View.extend({el:".user-state",events:{"click #regist-btn":"showRegist","submit #registration":"saveUser","change input":"updateProgress"},template:_.template(e("#user-template").html()),initialize:function(){this.formLayer=e(".regist"),this.registBtn=e("#regist-btn"),this.$userInfo=e("#user"),this.form=e("#registration"),this.jobTitle=e("#jobTitle"),this.submitBtn=e("#submit"),this.$progress=e("#r-f-p"),this.formProgress=0,this.sNameInput=new SuperInput(e("#name")),this.sNameInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.nameWithSpace],this.sEmailInput=new SuperInput(e("#email")),this.sEmailInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.validEmail],this.sPwdInput=new SuperInput(e("#password")),this.sPwdInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.minLength(6),app.FormErrorChecker.maxLength(16),app.FormErrorChecker.alphaNumeric,app.FormErrorChecker.hasNumber,app.FormErrorChecker.hasLetter],this.formInputs=[this.sNameInput,this.sEmailInput,this.sPwdInput],this.sNameInput.checkOnChange(),this.sEmailInput.checkOnChange(),this.sPwdInput.checkOnChange().checkOnKeyup(),e(".regist-form").click(function(e){e.stopPropagation()}),e(".regist, .close-form").click(function(){e(".regist").hide(),e("#event-name").focus()}),this.listenTo(this.model,"change",this.render),this.model.fetch(),this.render()},render:function(){this.updateProgress(),this.model.get("login")?(this.formLayer.hide(),this.registBtn.hide(),e("#event-name").focus(),this.$userInfo.html(this.template({name:this.model.get("userName")}))):(this.formLayer.show(),this.sNameInput.input.focus(),this.registBtn.show())},showRegist:function(){this.render()},saveUser:function(){this.model.save({userName:this.sNameInput.getInputValue(),userEmail:this.sEmailInput.getInputValue(),userPwd:this.sPwdInput.getInputValue(),jboTitle:this.jobTitle.val(),login:!0})},updateProgress:function(){this.formProgress=0,_.each(this.formInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}})}(jQuery);var app=app||{};!function(){var e=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,t=/^[a-z]+$/i,s=/^[a-z0-9]+$/i,n=/^\s+$/,r=/^[a-zA-Z ]*$/;app.FormErrorMessages={required:"This field is required.",validEmail:"The email address is not valid.",minLength:"This field must contain at least %s characters.",maxLength:"This field must not exceed %s characters in length.",alpha:"This field must only contain alphabetical characters.",alphaNumeric:"This field must only contain alpha-numeric characters.",hasNumber:"This field must contain number.",hasLetter:"This field must contain letter.",nameWithSpace:"This field must only contain alphabetical characters and space between.",laterThanNow:"This should happen at a later time"},app.FormErrorChecker={required:function(e){return n.test(e)?app.FormErrorMessages.required:e.length<1?app.FormErrorMessages.required:""},validEmail:function(t){return e.test(t)?"":app.FormErrorMessages.validEmail},minLength:function(e){return function(t){return t.length<e?app.FormErrorMessages.minLength.replace("%s",e):""}},maxLength:function(e){return function(t){return t.length>e?app.FormErrorMessages.maxLength.replace("%s",e):""}},alpha:function(e){return t.test(e)?"":app.FormErrorMessages.alpha},alphaNumeric:function(e){return s.test(e)?"":app.FormErrorMessages.alphaNumeric},hasNumber:function(e){return e.match(/\d/g)?"":app.FormErrorMessages.hasNumber},hasLetter:function(e){return e.match(/[a-z,A-z]/g)?"":app.FormErrorMessages.hasLetter},nameWithSpace:function(e){return r.test(e)?"":app.FormErrorMessages.nameWithSpace},laterThanNow:function(e){if(e)return Date.parse(e)<(new Date).getTime()?app.FormErrorMessages.laterThanNow:""}}}();var SuperInput=function(e){this.input=e,this.requirements=[],this.isValid=!1,this.alertEl=e.parent().find(".alert")};SuperInput.prototype={getInputValue:function(){return this.input.val()},addMessage:function(e){this.messages.push(e)},getMessage:function(){var e="";return this.messages.length>0&&(e=this.messages.join(". \n")),e},validateInput:function(){var e=this.getInputValue();this.messages=[],_.each(this.requirements,function(t){var s=t(e);s&&this.addMessage(s)},this),this.messages.length?this.isValid=!1:this.isValid=!0},checkOnChange:function(){var e=this;return this.input.on("change blur",function(){e.validateInput(),e.alert()}),e},checkOnKeyup:function(){var e=this;return this.input.on("keyup",function(){e.validateInput(),e.alert()}),e},alert:function(){this.isValid?(this.alertEl.html(""),this.input.removeClass("invalid")):(this.alertEl.html(this.getMessage()),this.input.addClass("invalid"))}};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRpb24vdmFsaWRhdGlvbi5qcyIsImV2ZW50LmpzIiwidXNlci5qcyIsImNvbGxlY3Rpb25zL2V2ZW50cy5qcyIsInJvdXRlci9yb3V0ZXIuanMiLCJ2aWV3cy9ldmVudC5qcyIsInZpZXdzL21haW5WaWV3LmpzIiwidmlld3MvcmVnaXN0ZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGVPblN1Ym1pdCIsInNJbnB1dHMiLCJfIiwiZWFjaCIsInNJbnB1dCIsInZhbGlkYXRlSW5wdXQiLCJpbnB1dCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZ2V0TWVzc2FnZSIsImFwcCIsIkV2ZW50IiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwibmFtZSIsInR5cGUiLCJob3N0Iiwic3RhcnRUaW1lIiwiZW5kVGltZSIsImd1ZXN0TGlzdCIsImxvY2F0aW9uIiwiZXh0cmFJbmZvIiwiY29sb3IiLCJVc2VyIiwibG9naW4iLCJ1c2VyTmFtZSIsInVzZXJFbWFpbCIsInVzZXJQd2QiLCJsb2NhbFN0b3JhZ2UiLCJMb2NhbFN0b3JhZ2UiLCIkIiwidXNlciIsImlkIiwicmVnaXN0ZXIiLCJSZWdpc3RlclZpZXciLCJtb2RlbCIsIk1haW5WaWV3Iiwic3VibWl0QnRuIiwiY2xpY2siLCJmb3JtSW5wdXRzIiwiRXZlbnRzQ29sbGVjdGlvbiIsIkNvbGxlY3Rpb24iLCJldmVudHMiLCJSb3V0ZXIiLCJyb3V0ZXMiLCIiLCJsaXN0LWV2ZW50cyIsImRlZmF1bHRWaWV3IiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImZvY3VzIiwibGlzdEV2ZW50cyIsInJvdXRlciIsImhpc3RvcnkiLCJzdGFydCIsIkV2ZW50VmlldyIsIlZpZXciLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwidGVtcGxhdGUiLCJodG1sIiwiaW50aWFsaXplIiwidGhpcyIsImxpc3RlblRvIiwicmVuZGVyIiwiJGVsIiwiYXR0cmlidXRlcyIsImV2ZW50Q29sb3IiLCJnZXQiLCJjc3MiLCJiYWNrZ3JvdW5kIiwiYm9yZGVyLWNvbG9yIiwialF1ZXJ5IiwiZWwiLCJjbGljayAjYWRkIiwic3VibWl0ICNhZGQtZXZlbnQiLCJjaGFuZ2UgaW5wdXQsIHRleHRhcmVhIiwiaW5pdGlhbGl6ZSIsIiRsaXN0IiwiJGV2ZW50c1ZpZXciLCIkZXZlbnRGb3JtIiwiJHByb2dyZXNzIiwiZm9ybVByb2dyZXNzIiwiZXZlbnRIb3N0IiwiU3VwZXJJbnB1dCIsImV2ZW50TmFtZSIsImV2ZW50VHlwZSIsImV2ZW50TG9jYXRpb24iLCJyZXF1aXJlZElucHV0cyIsInJlcXVpcmVtZW50cyIsInB1c2giLCJGb3JtRXJyb3JDaGVja2VyIiwicmVxdWlyZWQiLCJjaGVja09uQ2hhbmdlIiwibGF0ZXJUaGFuTm93IiwidmFsdWUiLCJ2YWwiLCJEYXRlIiwicGFyc2UiLCIkZm9ybSIsImFwcEhlaWdodCIsIm9mZnNldEhlaWdodCIsImFwcGVuZEl0ZW0iLCJmZXRjaCIsImV2ZW50IiwidmlldyIsImFwcGVuZCIsInZhbGlkYXRlIiwiY3JlYXRlRXZlbnQiLCJjcmVhdGUiLCJnZXRJbnB1dFZhbHVlIiwicmVzZXRGb3JtIiwicmVzZXQiLCJwcm9ncmVzcyIsImlzVmFsaWQiLCJjbGljayAjcmVnaXN0LWJ0biIsInN1Ym1pdCAjcmVnaXN0cmF0aW9uIiwiY2hhbmdlIGlucHV0IiwiZm9ybUxheWVyIiwicmVnaXN0QnRuIiwiJHVzZXJJbmZvIiwiZm9ybSIsImpvYlRpdGxlIiwic05hbWVJbnB1dCIsIm5hbWVXaXRoU3BhY2UiLCJzRW1haWxJbnB1dCIsInZhbGlkRW1haWwiLCJzUHdkSW5wdXQiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJhbHBoYU51bWVyaWMiLCJoYXNOdW1iZXIiLCJoYXNMZXR0ZXIiLCJjaGVja09uS2V5dXAiLCJlIiwic3RvcFByb3BhZ2F0aW9uIiwiaGlkZSIsInVwZGF0ZVByb2dyZXNzIiwic2hvdyIsInNob3dSZWdpc3QiLCJzYXZlVXNlciIsInNhdmUiLCJqYm9UaXRsZSIsImVtYWlsUmVnZXgiLCJhbHBoYVJlZ2V4IiwiYWxwaGFOdW1lcmljUmVnZXgiLCJzcGFjZVJlZ2V4IiwibmFtZVJlZ2V4IiwiRm9ybUVycm9yTWVzc2FnZXMiLCJhbHBoYSIsInRlc3QiLCJsZW5ndGgiLCJyZXBsYWNlIiwibWF0Y2giLCJnZXRUaW1lIiwiYWxlcnRFbCIsInBhcmVudCIsImZpbmQiLCJwcm90b3R5cGUiLCJhZGRNZXNzYWdlIiwibWVzc2FnZSIsIm1lc3NhZ2VzIiwiam9pbiIsInJlcXVpcmVtZW50IiwibXNnIiwic2VsZiIsIm9uIiwiYWxlcnQiXSwibWFwcGluZ3MiOiJBQStLQSxRQUFBQSxrQkFBQUMsR0FDQUMsRUFBQUMsS0FBQUYsRUFBQSxTQUFBRyxHQUNBQSxFQUFBQyxnQkFDQUQsRUFBQUUsTUFBQSxHQUFBQyxrQkFBQUgsRUFBQUksZ0JDbExBLEdBQUFDLEtBQUFBLFNBR0EsV0FDQUEsSUFBQUMsTUFBQUMsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQUMsS0FBQSxHQUNBQyxLQUFBLEdBQ0FDLEtBQUEsR0FDQUMsVUFBQSxHQUNBQyxRQUFBLEdBQ0FDLFVBQUEsMEJBQ0FDLFNBQUEsR0FDQUMsVUFBQSw0QkFDQUMsTUFBQSxlQ2RBLElBQUFkLEtBQUFBLFNBRUEsV0FDQUEsSUFBQWUsS0FBQWIsU0FBQUMsTUFBQUMsUUFDQUMsVUFDQVcsT0FBQSxFQUNBQyxTQUFBLEdBQ0FDLFVBQUEsR0FDQUMsUUFBQSxJQUdBQyxhQUFBLEdBQUFsQixVQUFBbUIsYUFBQSxhRFhBQyxFQUFBLFdBRUEsR0FBQUMsR0FBQSxHQUFBdkIsS0FBQWUsTUFBQVMsR0FBQSxJQUdBQyxFQUFBLEdBQUF6QixLQUFBMEIsY0FBQUMsTUFBQUosR0FHQSxJQUFBdkIsS0FBQTRCLFFBR0EsSUFBQUMsR0FBQVAsRUFBQSxVQUdBTyxHQUFBQyxNQUFBLFdBQ0F2QyxpQkFBQWtDLEVBQUFNLGVFZkEsSUFBQS9CLEtBQUFBLFNBRUEsV0FDQUEsSUFBQWdDLGlCQUFBOUIsU0FBQStCLFdBQUE3QixRQUVBdUIsTUFBQTNC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MkMsU0FBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgLy9yZWd1bGFyIGV4cHJlc3Npb25zXG4gICAgdmFyIGVtYWlsUmVnZXggPSAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC8sXG4gICAgICAgIGFscGhhUmVnZXggPSAvXlthLXpdKyQvaSxcbiAgICAgICAgYWxwaGFOdW1lcmljUmVnZXggPSAvXlthLXowLTldKyQvaSxcbiAgICAgICAgc3BhY2VSZWdleCA9IC9eXFxzKyQvLFxuICAgICAgICBuYW1lUmVnZXggPSAvXlthLXpBLVogXSokLztcblxuICAgIC8vbWVzc2FnZXMgd2hlbiByZXF1aXJlbWVudCBkb2Vzbid0IHBhc3NcbiAgICBhcHAuRm9ybUVycm9yTWVzc2FnZXMgPSB7XG4gICAgICAgIHJlcXVpcmVkOiAnVGhpcyBmaWVsZCBpcyByZXF1aXJlZC4nLFxuICAgICAgICB2YWxpZEVtYWlsOiAnVGhlIGVtYWlsIGFkZHJlc3MgaXMgbm90IHZhbGlkLicsXG4gICAgICAgIG1pbkxlbmd0aDogJ1RoaXMgZmllbGQgbXVzdCBjb250YWluIGF0IGxlYXN0ICVzIGNoYXJhY3RlcnMuJyxcbiAgICAgICAgbWF4TGVuZ3RoOiAnVGhpcyBmaWVsZCBtdXN0IG5vdCBleGNlZWQgJXMgY2hhcmFjdGVycyBpbiBsZW5ndGguJyxcbiAgICAgICAgYWxwaGE6ICdUaGlzIGZpZWxkIG11c3Qgb25seSBjb250YWluIGFscGhhYmV0aWNhbCBjaGFyYWN0ZXJzLicsXG4gICAgICAgIGFscGhhTnVtZXJpYzogJ1RoaXMgZmllbGQgbXVzdCBvbmx5IGNvbnRhaW4gYWxwaGEtbnVtZXJpYyBjaGFyYWN0ZXJzLicsXG4gICAgICAgIGhhc051bWJlcjogJ1RoaXMgZmllbGQgbXVzdCBjb250YWluIG51bWJlci4nLFxuICAgICAgICBoYXNMZXR0ZXI6ICdUaGlzIGZpZWxkIG11c3QgY29udGFpbiBsZXR0ZXIuJyxcbiAgICAgICAgbmFtZVdpdGhTcGFjZTogJ1RoaXMgZmllbGQgbXVzdCBvbmx5IGNvbnRhaW4gYWxwaGFiZXRpY2FsIGNoYXJhY3RlcnMgYW5kIHNwYWNlIGJldHdlZW4uJyxcbiAgICAgICAgbGF0ZXJUaGFuTm93OiAnVGhpcyBzaG91bGQgaGFwcGVuIGF0IGEgbGF0ZXIgdGltZSdcbiAgICB9O1xuXG4gICAgLy9tZXRob2RzIHRvIHZhbGlkYXRlIHRoZSBpbnB1dCB2YWx1ZVxuICAgIGFwcC5Gb3JtRXJyb3JDaGVja2VyID0ge1xuICAgICAgICByZXF1aXJlZDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlIHZhbHVlIG9ubHkgY290YWlucyBzcGFjZXNcbiAgICAgICAgICAgIGlmIChzcGFjZVJlZ2V4LnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5yZXF1aXJlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGg8MSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMucmVxdWlyZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIHZhbGlkRW1haWw6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIWVtYWlsUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLnZhbGlkRW1haWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIG1pbkxlbmd0aDogZnVuY3Rpb24obGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMubWluTGVuZ3RoLnJlcGxhY2UoJyVzJywgbGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgbWF4TGVuZ3RoOiBmdW5jdGlvbihsZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5tYXhMZW5ndGgucmVwbGFjZSgnJXMnLCBsZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBhbHBoYTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghYWxwaGFSZWdleC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMuYWxwaGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGFscGhhTnVtZXJpYzogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghYWxwaGFOdW1lcmljUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLmFscGhhTnVtZXJpYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgaGFzTnVtYmVyOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2YWx1ZS5tYXRjaCgvXFxkL2cpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcC5Gb3JtRXJyb3JNZXNzYWdlcy5oYXNOdW1iZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGhhc0xldHRlcjogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdmFsdWUubWF0Y2goL1thLXosQS16XS9nKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMuaGFzTGV0dGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9LFxuICAgICAgICBuYW1lV2l0aFNwYWNlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCFuYW1lUmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBwLkZvcm1FcnJvck1lc3NhZ2VzLm5hbWVXaXRoU3BhY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGxhdGVyVGhhbk5vdzogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChEYXRlLnBhcnNlKHZhbHVlKSA8IG5ldyBEYXRlKCkuZ2V0VGltZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcHAuRm9ybUVycm9yTWVzc2FnZXMubGF0ZXJUaGFuTm93O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufSkoKTtcblxuLyoqXG4gKiBNYWtlIGEgaW5wdXQgdG8gYSBTdXBlcklucHV0IHRvIHZhbGlkYXRlIGl0cyB2YWx1ZVxuICovXG52YXIgU3VwZXJJbnB1dCA9IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgIHRoaXMucmVxdWlyZW1lbnRzID0gW107XG4gICAgdGhpcy5pc1ZhbGlkID0gZmFsc2U7XG4gICAgdGhpcy5hbGVydEVsID0gaW5wdXQucGFyZW50KCkuZmluZCgnLmFsZXJ0Jyk7XG59XG5cblN1cGVySW5wdXQucHJvdG90eXBlID0ge1xuICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC52YWwoKTtcbiAgICB9LFxuXG4gICAgYWRkTWVzc2FnZSA6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgIH0sXG5cbiAgICBnZXRNZXNzYWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSAnJztcbiAgICAgICAgaWYodGhpcy5tZXNzYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBtZXNzYWdlID0gdGhpcy5tZXNzYWdlcy5qb2luKCcuIFxcbicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgIH0sXG5cbiAgICB2YWxpZGF0ZUlucHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcblxuICAgICAgICBfLmVhY2godGhpcy5yZXF1aXJlbWVudHMsIGZ1bmN0aW9uKHJlcXVpcmVtZW50KSB7XG4gICAgICAgICAgICB2YXIgbXNnID0gcmVxdWlyZW1lbnQodmFsdWUpO1xuICAgICAgICAgICAgaWYobXNnKXtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UobXNnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNWYWxpZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hlY2tPbkNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5pbnB1dC5vbignY2hhbmdlIGJsdXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYudmFsaWRhdGVJbnB1dCgpO1xuICAgICAgICAgICAgc2VsZi5hbGVydCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfSxcblxuICAgIGNoZWNrT25LZXl1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5pbnB1dC5vbigna2V5dXAnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYudmFsaWRhdGVJbnB1dCgpO1xuICAgICAgICAgICAgc2VsZi5hbGVydCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfSxcblxuICAgIGFsZXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWxlcnRFbC5odG1sKHRoaXMuZ2V0TWVzc2FnZSgpKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWxlcnRFbC5odG1sKCcnKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQucmVtb3ZlQ2xhc3MoJ2ludmFsaWQnKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cblxuLy92YWxpZGF0ZSB3aGVuIHN1Ym1pdHRpbmcgdGhlIGZvcm1cbmZ1bmN0aW9uIHZhbGlkYXRlT25TdWJtaXQoc0lucHV0cykge1xuICAgIF8uZWFjaChzSW5wdXRzLCBmdW5jdGlvbihzSW5wdXQpIHtcbiAgICAgICAgc0lucHV0LnZhbGlkYXRlSW5wdXQoKTtcbiAgICAgICAgc0lucHV0LmlucHV0WzBdLnNldEN1c3RvbVZhbGlkaXR5KHNJbnB1dC5nZXRNZXNzYWdlKCkpO1xuICAgIH0pO1xufSIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbi8vTW9kZWwgZm9yIGEgZXZlbnRcbihmdW5jdGlvbigpIHtcbiAgICBhcHAuRXZlbnQgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICB0eXBlOiAnJyxcbiAgICAgICAgICAgIGhvc3Q6ICcnLFxuICAgICAgICAgICAgc3RhcnRUaW1lOiAnJyxcbiAgICAgICAgICAgIGVuZFRpbWU6ICcnLFxuICAgICAgICAgICAgZ3Vlc3RMaXN0OiAnQ29vbGVzdCBwZW9wbGUgb24gZWFydGgnLFxuICAgICAgICAgICAgbG9jYXRpb246ICcnLFxuICAgICAgICAgICAgZXh0cmFJbmZvOidObyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uJyxcbiAgICAgICAgICAgIGNvbG9yOiAnI2ZlYzAwMCdcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbigpIHtcbiAgICBhcHAuVXNlciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBsb2dpbjogZmFsc2UsXG4gICAgICAgICAgICB1c2VyTmFtZTogJycsXG4gICAgICAgICAgICB1c2VyRW1haWw6ICcnLFxuICAgICAgICAgICAgdXNlclB3ZDogJydcbiAgICAgICAgfSxcbiAgICAgICAgLy9zYXZpbmcgdXNlciBpbmZvIHRvIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgbG9jYWxTdG9yYWdlOiBuZXcgQmFja2JvbmUuTG9jYWxTdG9yYWdlKCd1c2VyJyksXG4gICAgfSk7XG59KSgpO1xuIiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKCkge1xuICAgIGFwcC5FdmVudHNDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuICAgICAgICAvL3JlZmVyZW5jZSB0byBpdHMgbW9kZWxcbiAgICAgICAgbW9kZWw6IGFwcC5FdmVudCxcbiAgICAgICAgbG9jYWxTdG9yYWdlOiBuZXcgQmFja2JvbmUuTG9jYWxTdG9yYWdlKCdldmVudHMnKSxcbiAgICB9KTtcbiAgICBcbiAgICBhcHAuZXZlbnRzID0gbmV3IGFwcC5FdmVudHNDb2xsZWN0aW9uKCk7XG59KSgpO1xuIiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKCkge1xuICAgIC8qKlxuICAgICAqIFRoZSByb3V0ZXIgbWFrZSBzdXJlIHRoZSB1cmwgY2hhbmdlIHdpbGwgY2hhbmdlIHRoZSBhcHAncyB2aWV3LCB0aGUgcmlnaHQgdXJsXG4gICAgICogYWx3YXlzIGJyaW5ncyB0aGUgcmlnaHQgdmlld1xuICAgICAqL1xuICAgIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIuZXh0ZW5kKHtcbiAgICAgICAgcm91dGVzOiB7XG4gICAgICAgICAgICAnJzogJ2RlZmF1bHRWaWV3JyxcbiAgICAgICAgICAgICdsaXN0LWV2ZW50cyc6ICdsaXN0RXZlbnRzJ1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vbWFrZSBzdXJlIHRoZSByaWdodCB2aWV3IGlzIG9wZW5cbiAgICAgICAgZGVmYXVsdFZpZXc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLmV2ZW50LWZvcm0nKS5hZGRDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgJCgnLmV2ZW50cy12aWV3JykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICQoJy5hZGRFdmVudCcpLmFkZENsYXNzKCdjdXJyZW50Jyk7XG4gICAgICAgICAgICAkKCcubGlzdEV2ZW50JykucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgICAgICQoJyNldmVudC1uYW1lJykuZm9jdXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsaXN0RXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5ldmVudC1mb3JtJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICQoJy5ldmVudHMtdmlldycpLmFkZENsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICAkKCcuYWRkRXZlbnQnKS5yZW1vdmVDbGFzcygnY3VycmVudCcpO1xuICAgICAgICAgICAgJCgnLmxpc3RFdmVudCcpLmFkZENsYXNzKCdjdXJyZW50Jyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGFwcC5yb3V0ZXIgPSBuZXcgUm91dGVyKCk7XG4gICAgQmFja2JvbmUuaGlzdG9yeS5zdGFydCgpO1xufSkoKTtcbiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbigkKSB7XG4gICAgYXBwLkV2ZW50VmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICAgICAgdGFnTmFtZTogJ2xpJyxcblxuICAgICAgICBjbGFzc05hbWU6ICdldmVudCcsXG4gICAgICAgIC8vdGVtcGxhdGUgdG8gcmVuZGVyIGEgZXZlbnRcbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJCgnI2V2ZW50LXRlbXBsYXRlJykuaHRtbCgpKSxcblxuICAgICAgICAvL2xpc3RlbiB0byBtb2RlbCBldmVudCBpbiBpbml0aWFsaXphdGlvblxuICAgICAgICBpbnRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAnY2hhbmdlJywgdGhpcy5yZW5kZXIpO1xuICAgICAgICB9LFxuICAgICAgICAvL3JlbmJlciBhIHNpbmdsZSBldmVudCdzIHZpZXdcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSh0aGlzLm1vZGVsLmF0dHJpYnV0ZXMpKTtcbiAgICAgICAgICAgIHZhciBldmVudENvbG9yID0gdGhpcy5tb2RlbC5nZXQoJ2NvbG9yJyk7XG4gICAgICAgICAgICB0aGlzLiRlbC5jc3Moe1xuICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kJzogZXZlbnRDb2xvcixcbiAgICAgICAgICAgICAgICAnYm9yZGVyLWNvbG9yJzogZXZlbnRDb2xvcixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oJCkge1xuICAgIGFwcC5NYWluVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICAgICAgZWw6ICcucGxhbmVyLWFwcCcsXG5cbiAgICAgICAgZXZlbnRzOiB7XG4gICAgICAgICAgICAnY2xpY2sgI2FkZCc6ICd2YWxpZGF0ZScsXG4gICAgICAgICAgICAnc3VibWl0ICNhZGQtZXZlbnQnOiAnY3JlYXRlRXZlbnQnLFxuICAgICAgICAgICAgJ2NoYW5nZSBpbnB1dCwgdGV4dGFyZWEnOiAncHJvZ3Jlc3MnXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL2NhY2hlIGRvbSBlbGVtZW50XG4gICAgICAgICAgICB0aGlzLiRsaXN0ID0gJCgnLmV2ZW50LWxpc3QnKTtcbiAgICAgICAgICAgIHRoaXMuJGV2ZW50c1ZpZXcgPSAkKCcuZXZlbnRzLXZpZXcnKTtcbiAgICAgICAgICAgIHRoaXMuJGV2ZW50Rm9ybSA9ICQoJy5ldmVudC1mb3JtJyk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcyA9ICQoJyNlLWYtcCcpO1xuXG4gICAgICAgICAgICB0aGlzLmZvcm1Qcm9ncmVzcyA9IDE7XG4gICAgICAgICAgICAvL2FsbCB0aGUgaW5wdXRzXG4gICAgICAgICAgICB0aGlzLmV2ZW50SG9zdCA9IG5ldyBTdXBlcklucHV0KCQoJyNldmVudC1ob3N0JykpO1xuICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gbmV3IFN1cGVySW5wdXQoJCgnI2VuZC10aW1lJykpO1xuICAgICAgICAgICAgdGhpcy5ndWVzdExpc3QgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZ3Vlc3QtbGlzdCcpKTtcbiAgICAgICAgICAgIHRoaXMuZXh0cmFJbmZvID0gbmV3IFN1cGVySW5wdXQoJCgnI2V4dHJhLWluZm8nKSk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50Q29sb3IgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZXZlbnQtY29sb3InKSk7XG5cbiAgICAgICAgICAgIHRoaXMuZXZlbnROYW1lID0gIG5ldyBTdXBlcklucHV0KCQoJyNldmVudC1uYW1lJykpO1xuICAgICAgICAgICAgdGhpcy5ldmVudFR5cGUgPSBuZXcgU3VwZXJJbnB1dCgkKCcjZXZlbnQtdHlwZScpKTtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gbmV3IFN1cGVySW5wdXQoJCgnI3N0YXJ0LXRpbWUnKSk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TG9jYXRpb24gPSBuZXcgU3VwZXJJbnB1dCgkKCcjZXZlbnQtbG9jYXRpb24nKSk7XG4gICAgICAgICAgICB0aGlzLnJlcXVpcmVkSW5wdXRzID0gW3RoaXMuZXZlbnROYW1lLCB0aGlzLmV2ZW50VHlwZSwgdGhpcy5ldmVudEhvc3QsIHRoaXMuZXZlbnRMb2NhdGlvbiwgdGhpcy5ndWVzdExpc3QsIHRoaXMuc3RhcnRUaW1lLCB0aGlzLmVuZFRpbWVdO1xuICAgICAgICAgICAgLy9mb3IgZXZlcnkgcmVxdWlyZWQgaW5wdXRzIGFkZCByZXF1aXJlZCB0byB0aGVpciByZXF1aXJlbWVudHNcbiAgICAgICAgICAgIF8uZWFjaCh0aGlzLnJlcXVpcmVkSW5wdXRzLCBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlucHV0LnJlcXVpcmVtZW50cy5wdXNoKGFwcC5Gb3JtRXJyb3JDaGVja2VyLnJlcXVpcmVkKTtcbiAgICAgICAgICAgICAgICBpbnB1dC5jaGVja09uQ2hhbmdlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vdGhlc2UgdHdvIG5lZWQgdG8gaGF2ZSBhIHRpbWUgY2hlY2tcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lLnJlcXVpcmVtZW50cy5wdXNoKGFwcC5Gb3JtRXJyb3JDaGVja2VyLmxhdGVyVGhhbk5vdyk7XG4gICAgICAgICAgICB0aGlzLmVuZFRpbWUucmVxdWlyZW1lbnRzLnB1c2goYXBwLkZvcm1FcnJvckNoZWNrZXIubGF0ZXJUaGFuTm93LCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBzdGFydFRpbWUgPSAkKCcjc3RhcnQtdGltZScpLnZhbCgpO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoRGF0ZS5wYXJzZSh2YWx1ZSkgPD0gRGF0ZS5wYXJzZShzdGFydFRpbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ1RoaXMgc2hvdWxkIGhhcHBlbiBsYXRlciB0aGFuIHN0YXJ0IHRpbWUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICB0aGlzLiRmb3JtID0gJCgnI2FkZC1ldmVudCcpO1xuICAgICAgICAgICAgLy9zZXQgdGhlIGRlZmF1bHQgY29sb3JcbiAgICAgICAgICAgICQoJyNldmVudC1jb2xvcicpLnZhbCgnI0ZFQ0UwMCcpO1xuXG4gICAgICAgICAgICB0aGlzLmFwcEhlaWdodCA9IHRoaXMuJGV2ZW50Rm9ybVswXS5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgICAgICAgIC8vbGlzdGVuIHRvIGNvbGxlY3Rpb24gZXZlbnRcbiAgICAgICAgICAgIHRoaXMubGlzdGVuVG8oYXBwLmV2ZW50cywgJ2FkZCcsIHRoaXMuYXBwZW5kSXRlbSk7XG4gICAgICAgICAgICAvL2ZldGNoIGRhdGEgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICAgICAgICAgIGFwcC5ldmVudHMuZmV0Y2goKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vZHJhZyB0aGUgZXZlbnRzIHZpZXcgdG8gdGhlIHJpZ2h0IHBsYWNlXG4gICAgICAgICAgICB0aGlzLiRldmVudHNWaWV3LmNzcygnbWFyZ2luLXRvcCcsIC10aGlzLmFwcEhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLiRldmVudHNWaWV3LmNzcygnaGVpZ2h0JywgdGhpcy5hcHBIZWlnaHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFwcGVuZEl0ZW06IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAvL2NyZWF0ZSBhIHZpZXcgZm9yIHRoZSBldmVudFxuICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgYXBwLkV2ZW50Vmlldyh7bW9kZWw6IGV2ZW50fSk7XG4gICAgICAgICAgICAvL2FwcGVuZCBpdCB0byB0aGUgbGlzdFxuICAgICAgICAgICAgdGhpcy4kbGlzdC5hcHBlbmQodmlldy5yZW5kZXIoKS5lbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFsaWRhdGVPblN1Ym1pdCh0aGlzLnJlcXVpcmVkSW5wdXRzKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL2NyZWF0ZSBhbiBldmVudCBtb2RlbFxuICAgICAgICAgICAgYXBwLmV2ZW50cy5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuZXZlbnROYW1lLmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmV2ZW50VHlwZS5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgaG9zdDogdGhpcy5ldmVudEhvc3QuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdGhpcy5zdGFydFRpbWUuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIGVuZFRpbWU6IHRoaXMuZW5kVGltZS5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgZ3Vlc3RMaXN0OiB0aGlzLmV2ZW50TG9jYXRpb24uZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB0aGlzLmd1ZXN0TGlzdC5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgZXh0cmFJbmZvOiB0aGlzLmV4dHJhSW5mby5nZXRJbnB1dFZhbHVlKCksXG4gICAgICAgICAgICAgICAgY29sb3I6IHRoaXMuZXZlbnRDb2xvci5nZXRJbnB1dFZhbHVlKClcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnJlc2V0Rm9ybSgpO1xuICAgICAgICAgICAgLy9wcmV2ZW50IHJlbG9hZCBwYWdlXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9yZXNldCB0aGUgZm9ybVxuICAgICAgICByZXNldEZvcm06IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy4kZm9ybVswXS5yZXNldCgpO1xuICAgICAgICAgICAgdGhpcy4kcHJvZ3Jlc3MudmFsKDApO1xuICAgICAgICAgICAgJCgnI2V2ZW50LWNvbG9yJykudmFsKCcjRkVDRTAwJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy91cGRhdGUgdGhlIHByb2dyZXNzIGJhclxuICAgICAgICBwcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm1Qcm9ncmVzcyA9IDA7XG4gICAgICAgICAgICBfLmVhY2godGhpcy5yZXF1aXJlZElucHV0cywgZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpZihpbnB1dC5pc1ZhbGlkKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1Qcm9ncmVzcysrO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcy52YWwodGhpcy5mb3JtUHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpO1xuIiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKCQpIHtcbiAgICBhcHAuUmVnaXN0ZXJWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgICAgICBlbDogJy51c2VyLXN0YXRlJyxcblxuICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgICdjbGljayAjcmVnaXN0LWJ0bic6ICdzaG93UmVnaXN0JyxcbiAgICAgICAgICAgICdzdWJtaXQgI3JlZ2lzdHJhdGlvbic6ICdzYXZlVXNlcicsXG4gICAgICAgICAgICAnY2hhbmdlIGlucHV0JzogJ3VwZGF0ZVByb2dyZXNzJ1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vdGVtcGxhdGUgZm9yIHRoZSB1c2VyXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCQoJyN1c2VyLXRlbXBsYXRlJykuaHRtbCgpKSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybUxheWVyID0gJCgnLnJlZ2lzdCcpO1xuICAgICAgICAgICAgdGhpcy5yZWdpc3RCdG4gPSAkKCcjcmVnaXN0LWJ0bicpO1xuICAgICAgICAgICAgdGhpcy4kdXNlckluZm8gPSAkKCcjdXNlcicpO1xuXG4gICAgICAgICAgICAvL2NhY2hlIHVzZXIgcmVnaXN0cmF0aW9uIGZvcm1cbiAgICAgICAgICAgIHRoaXMuZm9ybSA9ICQoJyNyZWdpc3RyYXRpb24nKTtcbiAgICAgICAgICAgIHRoaXMuam9iVGl0bGUgPSAkKCcjam9iVGl0bGUnKTtcbiAgICAgICAgICAgIHRoaXMuc3VibWl0QnRuID0gJCgnI3N1Ym1pdCcpO1xuICAgICAgICAgICAgdGhpcy4kcHJvZ3Jlc3MgPSAkKCcjci1mLXAnKTtcbiAgICAgICAgICAgIHRoaXMuZm9ybVByb2dyZXNzID0gMDtcbiAgICAgICAgICAgIC8vTWFrZSBpbnB1dCB0byBTdXBlcklucHV0LCB1c2UgaXRzIG1ldGhvZCB0byB2YWxpZGF0ZSBpbnB1dCB2YWx1ZVxuICAgICAgICAgICAgdGhpcy5zTmFtZUlucHV0ID0gbmV3IFN1cGVySW5wdXQoJCgnI25hbWUnKSk7XG4gICAgICAgICAgICAvL3NldCByZXF1aXJlbWVudHMgZm9yIGVsZW1lbnRcbiAgICAgICAgICAgIHRoaXMuc05hbWVJbnB1dC5yZXF1aXJlbWVudHMgPSBbYXBwLkZvcm1FcnJvckNoZWNrZXIucmVxdWlyZWQsIGFwcC5Gb3JtRXJyb3JDaGVja2VyLm5hbWVXaXRoU3BhY2VdO1xuXG4gICAgICAgICAgICB0aGlzLnNFbWFpbElucHV0ID0gbmV3IFN1cGVySW5wdXQoJCgnI2VtYWlsJykpO1xuICAgICAgICAgICAgdGhpcy5zRW1haWxJbnB1dC5yZXF1aXJlbWVudHMgPSBbYXBwLkZvcm1FcnJvckNoZWNrZXIucmVxdWlyZWQsIGFwcC5Gb3JtRXJyb3JDaGVja2VyLnZhbGlkRW1haWxdO1xuXG4gICAgICAgICAgICB0aGlzLnNQd2RJbnB1dCA9IG5ldyBTdXBlcklucHV0KCQoJyNwYXNzd29yZCcpKTtcbiAgICAgICAgICAgIHRoaXMuc1B3ZElucHV0LnJlcXVpcmVtZW50cyA9IFthcHAuRm9ybUVycm9yQ2hlY2tlci5yZXF1aXJlZCwgYXBwLkZvcm1FcnJvckNoZWNrZXIubWluTGVuZ3RoKDYpLCBhcHAuRm9ybUVycm9yQ2hlY2tlci5tYXhMZW5ndGgoMTYpLCBhcHAuRm9ybUVycm9yQ2hlY2tlci5hbHBoYU51bWVyaWMsIGFwcC5Gb3JtRXJyb3JDaGVja2VyLmhhc051bWJlciwgYXBwLkZvcm1FcnJvckNoZWNrZXIuaGFzTGV0dGVyXTtcblxuICAgICAgICAgICAgdGhpcy5mb3JtSW5wdXRzID0gW3RoaXMuc05hbWVJbnB1dCwgdGhpcy5zRW1haWxJbnB1dCwgdGhpcy5zUHdkSW5wdXRdO1xuICAgICAgICAgICAgLy92YWxpZGF0ZSBpbnB1dCB3aGVuIGlucHV0IHZhbHVlIGNoYW5nZXNcbiAgICAgICAgICAgIHRoaXMuc05hbWVJbnB1dC5jaGVja09uQ2hhbmdlKCk7XG4gICAgICAgICAgICB0aGlzLnNFbWFpbElucHV0LmNoZWNrT25DaGFuZ2UoKTtcbiAgICAgICAgICAgIC8vdmFsaWRhdGUgcGFzc3dvcmQgb24gZXZlcnkga2V5dXBcbiAgICAgICAgICAgIHRoaXMuc1B3ZElucHV0LmNoZWNrT25DaGFuZ2UoKS5jaGVja09uS2V5dXAoKTtcblxuICAgICAgICAgICAgLy9jbG9zZSB0aGUgZm9ybSB3aGVuIHVzZXIgY2xpY2sgb3V0c2lkZSB0aGUgZm9ybSBvciB1c2VyIGNsaWNrcyB0aGUgY2xvc2UgYnV0dG9uXG4gICAgICAgICAgICAkKCcucmVnaXN0LWZvcm0nKS5jbGljayhmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcucmVnaXN0LCAuY2xvc2UtZm9ybScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoJy5yZWdpc3QnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJCgnI2V2ZW50LW5hbWUnKS5mb2N1cygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vcmVtb3ZlIHRoZSBkb20gZWxlbWVudFxuICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAnY2hhbmdlJywgdGhpcy5yZW5kZXIpO1xuICAgICAgICAgICAgLy9mZXRjaCBkYXRhIGZyb20gbG9jYWxzdG9yYWdlXG4gICAgICAgICAgICB0aGlzLm1vZGVsLmZldGNoKCk7XG4gICAgICAgICAgICAvL3JlbmRlciB0aGUgdmlldyBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIC8vaWYgbm8gdXNlciBsb2dlZCBpbiBvcGVuIHRlaCByZWdpc3RlciBmb3JtXG4gICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuZ2V0KCdsb2dpbicpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtTGF5ZXIuc2hvdygpO1xuICAgICAgICAgICAgICAgIHRoaXMuc05hbWVJbnB1dC5pbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0QnRuLnNob3coKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtTGF5ZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0QnRuLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcjZXZlbnQtbmFtZScpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdXNlckluZm8uaHRtbCh0aGlzLnRlbXBsYXRlKHtuYW1lOiB0aGlzLm1vZGVsLmdldCgndXNlck5hbWUnKX0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvL3Nob3cgdGhlIHJlZ2lzdGVyIGZvcm1cbiAgICAgICAgc2hvd1JlZ2lzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vc2F2ZSB1c2VyIGRhdGFcbiAgICAgICAgc2F2ZVVzZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogdGhpcy5zTmFtZUlucHV0LmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICB1c2VyRW1haWw6IHRoaXMuc0VtYWlsSW5wdXQuZ2V0SW5wdXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgIHVzZXJQd2Q6IHRoaXMuc1B3ZElucHV0LmdldElucHV0VmFsdWUoKSxcbiAgICAgICAgICAgICAgICBqYm9UaXRsZTogdGhpcy5qb2JUaXRsZS52YWwoKSwgXG4gICAgICAgICAgICAgICAgbG9naW46IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvL2NoZWNrIHByb2dyZXNzIGFuZCB1cGRhdGUgcHJvZ3Jlc3NiYXIgdmFsdWVcbiAgICAgICAgdXBkYXRlUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5mb3JtUHJvZ3Jlc3MgPSAwO1xuICAgICAgICAgICAgXy5lYWNoKHRoaXMuZm9ybUlucHV0cywgZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpZihpbnB1dC5pc1ZhbGlkKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1Qcm9ncmVzcysrO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLiRwcm9ncmVzcy52YWwodGhpcy5mb3JtUHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpOyBcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
