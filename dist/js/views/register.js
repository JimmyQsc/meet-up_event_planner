var app=app||{};app.RegisterView=Backbone.View.extend({el:".user-state",events:{"click #regist-btn":"showRegist","submit #registration":"saveUser","change input":"updateProgress"},template:_.template($("#user-template").html()),initialize:function(){this.formLayer=$(".regist"),this.registBtn=$("#regist-btn"),this.$userInfo=$("#user"),this.form=$("#registration"),this.submitBtn=$("#submit"),this.$progress=$("progress"),this.formProgress=0,this.sNameInput=new SuperInput($("#name")),this.sNameInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.nameWithSpace],this.sEmailInput=new SuperInput($("#email")),this.sEmailInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.validEmail],this.sPwdInput=new SuperInput($("#password")),this.sPwdInput.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.minLength,app.FormErrorChecker.maxLength,app.FormErrorChecker.alphaNumeric,app.FormErrorChecker.hasNumber,app.FormErrorChecker.hasLetter],this.formInputs=[this.sNameInput,this.sEmailInput,this.sPwdInput],this.sNameInput.checkOnEdit(),this.sEmailInput.checkOnEdit(),this.sPwdInput.checkOnEdit(),$(".regist-form").click(function(e){e.stopPropagation()}),$(".regist, .close-form").click(function(){$(".regist").hide()}),this.listenTo(this.model,"change",this.render),this.model.fetch(),this.render()},render:function(){this.model.get("login")?(this.formLayer.hide(),this.registBtn.hide(),this.$userInfo.html(this.template({name:this.model.get("userName")}))):(this.formLayer.show(),this.registBtn.show())},showRegist:function(){this.render()},saveUser:function(){this.model.save({userName:this.sNameInput.getInputValue(),userEmail:this.sEmailInput.getInputValue(),userPwd:this.sPwdInput.getInputValue(),login:!0})},updateProgress:function(){this.formProgress=0,_.each(this.formInputs,function(e){e.isValid&&this.formProgress++},this),this.$progress.val(this.formProgress)}});