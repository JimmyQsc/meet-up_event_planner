var app=app||{};app.RegisterView=Backbone.View.extend({el:".user-state",events:{"click #regist-btn":"showRegist","submit #registration":"saveUser"},template:_.template($("#user-template").html()),initialize:function(){this.formLayer=$(".regist"),this.registBtn=$("#regist-btn"),this.$userInfo=$("#user"),this.form=$("#registration"),this.nameInput=$("#name"),this.emailInput=$("#email"),this.pwdInput=$("#password"),this.submitBtn=$("#submit"),this.nameInput.validator=new app.CustomValidator($("#name")),this.nameInput.validator.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.nameWithSpace],this.emailInput.validator=new app.CustomValidator($("#email")),this.emailInput.validator.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.validEmail],this.pwdInput.validator=new app.CustomValidator($("#password")),this.pwdInput.validator.requirements=[app.FormErrorChecker.required,app.FormErrorChecker.minLength,app.FormErrorChecker.maxLength,app.FormErrorChecker.alphaNumeric,app.FormErrorChecker.hasNumber,app.FormErrorChecker.hasLetter],this.formInputs=[this.nameInput,this.emailInput,this.pwdInput],validateOnEdit(this.formInputs),$(".regist-form").click(function(e){e.stopPropagation()}),$(".regist, .close-form").click(function(){$(".regist").hide()}),this.listenTo(this.model,"change",this.render),this.model.fetch(),this.render()},render:function(){this.model.get("login")?(this.formLayer.hide(),this.registBtn.hide(),this.$userInfo.html(this.template({name:this.model.get("userName")}))):(this.formLayer.show(),this.registBtn.show())},showRegist:function(){this.render()},saveUser:function(){this.model.save({userName:this.nameInput.val(),userEmail:this.emailInput.val(),userPwd:this.pwdInput.val(),login:!0})}});